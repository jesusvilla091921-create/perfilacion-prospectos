<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Dashboard Supervisor | Servicios Integrales MADA</title>
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
Â  <style>
Â  Â  :root {
Â  Â  Â  --primary: #2563eb;
Â  Â  Â  --primary-dark: #1d4ed8;
Â  Â  Â  --primary-light: #3b82f6;
Â  Â  Â  --secondary: #0ea5e9;
Â  Â  Â  --accent: #06b6d4;
Â  Â  Â  --success: #10b981;
Â  Â  Â  --warning: #f59e0b;
Â  Â  Â  --error: #ef4444;
Â  Â  Â  --dark: #1e293b;
Â  Â  Â  --darker: #0f172a;
Â  Â  Â  --light: #f8fafc;
Â  Â  Â  --gray: #94a3b8;
Â  Â  Â  --text: #1e293b;
Â  Â  Â  --text-light: #64748b;
Â  Â  Â  --radius: 12px;
Â  Â  Â  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
Â  Â  Â  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
Â  Â  }

Â  Â  * {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  body {
Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
Â  Â  Â  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
Â  Â  Â  color: white;
Â  Â  Â  line-height: 1.5;
Â  Â  Â  min-height: 100vh;
Â  Â  }

Â  Â  /* Header */
Â  Â  .header {
Â  Â  Â  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
Â  Â  Â  padding: 1.5rem 2rem;
Â  Â  Â  box-shadow: var(--shadow-lg);
Â  Â  Â  position: relative;
Â  Â  Â  overflow: hidden;
Â  Â  }

Â  Â  .header::before {
Â  Â  Â  content: '';
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  right: 0;
Â  Â  Â  bottom: 0;
Â  Â  Â  background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
Â  Â  Â  opacity: 0.3;
Â  Â  }

Â  Â  .header-content {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  max-width: 1400px;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  position: relative;
Â  Â  }

Â  Â  .logo {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 15px;
Â  Â  }

Â  Â  .logo-icon {
Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  background: rgba(255, 255, 255, 0.2);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 60px;
Â  Â  Â  height: 60px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  }

Â  Â  .header-title h1 {
Â  Â  Â  font-size: 1.8rem;
Â  Â  Â  margin-bottom: 0.25rem;
Â  Â  }

Â  Â  .header-title p {
Â  Â  Â  opacity: 0.9;
Â  Â  Â  font-size: 0.95rem;
Â  Â  }

Â  Â  .header-actions {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 1rem;
Â  Â  }

Â  Â  .btn {
Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  border: none;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  display: inline-flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.5rem;
Â  Â  }

Â  Â  .btn-primary {
Â  Â  Â  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
Â  Â  Â  color: white;
Â  Â  Â  box-shadow: var(--shadow);
Â  Â  }

Â  Â  .btn-primary:hover {
Â  Â  Â  background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  box-shadow: var(--shadow-lg);
Â  Â  }

Â  Â  .btn-secondary {
Â  Â  Â  background: rgba(255, 255, 255, 0.2);
Â  Â  Â  color: white;
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.3);
Â  Â  }

Â  Â  .btn-secondary:hover {
Â  Â  Â  background: rgba(255, 255, 255, 0.3);
Â  Â  Â  transform: translateY(-2px);
Â  Â  }

Â  Â  /* Main Layout */
Â  Â  .main-container {
Â  Â  Â  max-width: 1400px;
Â  Â  Â  margin: 2rem auto;
Â  Â  Â  padding: 0 1.5rem;
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  gap: 1.5rem;
Â  Â  }

Â  Â  /* Stats Cards */
Â  Â  .stats-container {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
Â  Â  Â  gap: 1.5rem;
Â  Â  }

Â  Â  .stat-card {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  padding: 1.5rem;
Â  Â  Â  box-shadow: var(--shadow);
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  .stat-card-header {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  }

Â  Â  .stat-card-title {
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  color: rgba(255, 255, 255, 0.8);
Â  Â  Â  font-weight: 600;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 0.5px;
Â  Â  }

Â  Â  .stat-card-icon {
Â  Â  Â  width: 50px;
Â  Â  Â  height: 50px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  .stat-card-value {
Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  font-weight: 700;
Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  background: linear-gradient(135deg, #fff, #e2e8f0);
Â  Â  Â  -webkit-background-clip: text;
Â  Â  Â  -webkit-text-fill-color: transparent;
Â  Â  }

Â  Â  .stat-card-change {
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.25rem;
Â  Â  }

Â  Â  .stat-card-change.positive {
Â  Â  Â  color: var(--success);
Â  Â  }

Â  Â  .stat-card-change.negative {
Â  Â  Â  color: var(--error);
Â  Â  }

Â  Â  /* Filters */
Â  Â  .filters-container {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  padding: 1.5rem;
Â  Â  Â  box-shadow: var(--shadow);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  .filters-title {
Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.5rem;
Â  Â  }

Â  Â  .filters-grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  Â  Â  gap: 1rem;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  }

Â  Â  .filter-group {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 0.5rem;
Â  Â  }

Â  Â  .filter-label {
Â  Â  Â  font-weight: 600;
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  color: rgba(255, 255, 255, 0.9);
Â  Â  }

Â  Â  .filter-input {
Â  Â  Â  padding: 0.75rem;
Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.2);
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .filter-input:focus {
Â  Â  Â  outline: none;
Â  Â  Â  border-color: var(--primary);
Â  Â  Â  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
Â  Â  }

Â  Â  .filter-input option {
Â  Â  Â  background: var(--darker);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .filters-actions {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 1rem;
Â  Â  Â  justify-content: flex-end;
Â  Â  }

Â  Â  /* Content Tabs */
Â  Â  .content-tabs {
Â  Â  Â  display: flex;
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  border-radius: var(--radius) var(--radius) 0 0;
Â  Â  Â  overflow: hidden;
Â  Â  Â  box-shadow: var(--shadow);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  .tab {
Â  Â  Â  padding: 1rem 1.5rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: 600;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  border-bottom: 3px solid transparent;
Â  Â  Â  color: rgba(255, 255, 255, 0.7);
Â  Â  }

Â  Â  .tab.active {
Â  Â  Â  color: white;
Â  Â  Â  border-bottom-color: var(--primary);
Â  Â  Â  background: rgba(37, 99, 235, 0.1);
Â  Â  }

Â  Â  .tab:hover:not(.active) {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  /* Table */
Â  Â  .table-container {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  border-radius: 0 0 var(--radius) var(--radius);
Â  Â  Â  box-shadow: var(--shadow);
Â  Â  Â  overflow: hidden;
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  .table-wrapper {
Â  Â  Â  overflow-x: auto;
Â  Â  }

Â  Â  table {
Â  Â  Â  width: 100%;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  font-size: 0.9rem;
Â  Â  }

Â  Â  th {
Â  Â  Â  background: rgba(37, 99, 235, 0.3);
Â  Â  Â  color: white;
Â  Â  Â  text-align: left;
Â  Â  Â  padding: 1rem;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  td {
Â  Â  Â  padding: 1rem;
Â  Â  Â  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  color: rgba(255, 255, 255, 0.9);
Â  Â  }

Â  Â  tr:hover {
Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  }

Â  Â  .status-badge {
Â  Â  Â  display: inline-block;
Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  .status-completed {
Â  Â  Â  background-color: rgba(16, 185, 129, 0.2);
Â  Â  Â  color: var(--success);
Â  Â  }

Â  Â  /* Charts */
Â  Â  .charts-container {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
Â  Â  Â  gap: 1.5rem;
Â  Â  }

Â  Â  .chart-card {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  padding: 1.5rem;
Â  Â  Â  box-shadow: var(--shadow);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  .chart-title {
Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.5rem;
Â  Â  }

Â  Â  .chart-wrapper {
Â  Â  Â  position: relative;
Â  Â  Â  height: 300px;
Â  Â  }

Â  Â  /* Loader */
Â  Â  .loader {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 2rem;
Â  Â  }

Â  Â  .spinner {
Â  Â  Â  width: 40px;
Â  Â  Â  height: 40px;
Â  Â  Â  border: 4px solid rgba(255, 255, 255, 0.2);
Â  Â  Â  border-left-color: var(--primary);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  }

Â  Â  @keyframes spin {
Â  Â  Â  to {
Â  Â  Â  Â  transform: rotate(360deg);
Â  Â  Â  }
Â  Â  }

Â  Â  /* Footer */
Â  Â  footer {
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 1.5rem;
Â  Â  Â  color: rgba(255, 255, 255, 0.7);
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  margin-top: 2rem;
Â  Â  }

Â  Â  /* Responsive */
Â  Â  @media (max-width: 768px) {
Â  Â  Â  .header-content {
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  gap: 1rem;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  }

Â  Â  Â  .main-container {
Â  Â  Â  Â  padding: 0 1rem;
Â  Â  Â  }

Â  Â  Â  .charts-container {
Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  }

Â  Â  Â  .filters-grid {
Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  }

Â  Â  Â  .filters-actions {
Â  Â  Â  Â  justify-content: stretch;
Â  Â  Â  }

Â  Â  Â  .filters-actions .btn {
Â  Â  Â  Â  flex: 1;
Â  Â  Â  }
Â  Â  }

Â  Â  /* Toast Notification */
Â  Â  .toast {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 20px;
Â  Â  Â  right: 20px;
Â  Â  Â  padding: 1rem 1.5rem;
Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  background: rgba(255, 255, 255, 0.9);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  box-shadow: var(--shadow-lg);
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.75rem;
Â  Â  Â  z-index: 1000;
Â  Â  Â  transform: translateX(150%);
Â  Â  Â  transition: transform 0.3s ease;
Â  Â  Â  color: var(--text);
Â  Â  }

Â  Â  .toast.show {
Â  Â  Â  transform: translateX(0);
Â  Â  }

Â  Â  .toast-success {
Â  Â  Â  border-left: 4px solid var(--success);
Â  Â  }

Â  Â  .toast-error {
Â  Â  Â  border-left: 4px solid var(--error);
Â  Â  }

Â  Â  .toast-icon {
Â  Â  Â  font-size: 1.2rem;
Â  Â  }

Â  Â  .toast-message {
Â  Â  Â  font-weight: 500;
Â  Â  }
Â  </style>
</head>
<body>
Â  <header class="header">
Â  Â  <div class="header-content">
Â  Â  Â  <div class="logo">
Â  Â  Â  Â  <div class="logo-icon">ğŸ“Š</div>
Â  Â  Â  Â  <div class="header-title">
Â  Â  Â  Â  Â  <h1>Dashboard del Supervisor</h1>
Â  Â  Â  Â  Â  <p>Servicios Integrales MADA - Monitoreo en tiempo real</p>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="header-actions">
Â  Â  Â  Â  <button class="btn btn-secondary" id="btnActualizar">
Â  Â  Â  Â  Â  <i>â†»</i> Actualizar
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button class="btn btn-primary" id="btnExportar">
Â  Â  Â  Â  Â  <i>â¬‡</i> Exportar
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </header>

Â  <div class="main-container">
Â  Â  Â  Â  <div class="stats-container">
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-card-header">
Â  Â  Â  Â  Â  <div class="stat-card-title">Total Portabilidades</div>
Â  Â  Â  Â  Â  <div class="stat-card-icon">
Â  Â  Â  Â  Â  Â  <i>ğŸ“ˆ</i>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card-value" id="totalPortabilidades">0</div>
Â  Â  Â  Â  <div class="stat-card-change positive">
Â  Â  Â  Â  Â  <i>â†—</i> <span>+12% vs perÃ­odo anterior</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-card-header">
Â  Â  Â  Â  Â  <div class="stat-card-title">Promedio Diario</div>
Â  Â  Â  Â  Â  <div class="stat-card-icon">
Â  Â  Â  Â  Â  Â  <i>ğŸ“…</i>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card-value" id="promedioDiario">0</div>
Â  Â  Â  Â  <div class="stat-card-change positive">
Â  Â  Â  Â  Â  <i>â†—</i> <span>+5% vs perÃ­odo anterior</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-card-header">
Â  Â  Â  Â  Â  <div class="stat-card-title">Promotores Activos</div>
Â  Â  Â  Â  Â  <div class="stat-card-icon">
Â  Â  Â  Â  Â  Â  <i>ğŸ‘¥</i>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card-value" id="promotoresActivos">0</div>
Â  Â  Â  Â  <div class="stat-card-change positive">
Â  Â  Â  Â  Â  <i>â†—</i> <span>+2 vs perÃ­odo anterior</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-card-header">
Â  Â  Â  Â  Â  <div class="stat-card-title">Eficiencia</div>
Â  Â  Â  Â  Â  <div class="stat-card-icon">
Â  Â  Â  Â  Â  Â  <i>âš¡</i>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card-value" id="eficiencia">0%</div>
Â  Â  Â  Â  <div class="stat-card-change negative">
Â  Â  Â  Â  Â  <i>â†˜</i> <span>-3% vs perÃ­odo anterior</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="filters-container">
Â  Â  Â  <h2 class="filters-title">
Â  Â  Â  Â  <i>ğŸ”</i> Filtros de BÃºsqueda
Â  Â  Â  </h2>
Â  Â  Â  <div class="filters-grid">
Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  <label class="filter-label" for="fechaInicio">Desde:</label>
Â  Â  Â  Â  Â  <input type="date" id="fechaInicio" class="filter-input">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  <label class="filter-label" for="fechaFin">Hasta:</label>
Â  Â  Â  Â  Â  <input type="date" id="fechaFin" class="filter-input">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  <label class="filter-label" for="filtroPromotor">Promotor:</label>
Â  Â  Â  Â  Â  <select id="filtroPromotor" class="filter-input">
Â  Â  Â  Â  Â  Â  <option value="">Todos los promotores</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  <label class="filter-label" for="filtroEstado">Estado:</label>
Â  Â  Â  Â  Â  <select id="filtroEstado" class="filter-input">
Â  Â  Â  Â  Â  Â  <option value="">Todos los estados</option>
Â  Â  Â  Â  Â  Â  <option value="LISTO">LISTO</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="filters-actions">
Â  Â  Â  Â  <button class="btn btn-secondary" id="btnLimpiar">
Â  Â  Â  Â  Â  <i>ğŸ—‘ï¸</i> Limpiar
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button class="btn btn-primary" id="btnFiltrar">
Â  Â  Â  Â  Â  <i>ğŸ”</i> Aplicar Filtros
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="content-tabs">
Â  Â  Â  <div class="tab active" data-tab="tabla">ğŸ“‹ Vista de Tabla</div>
Â  Â  Â  <div class="tab" data-tab="graficas">ğŸ“Š Vista de GrÃ¡ficas</div>
Â  Â  </div>

Â  Â  Â  Â  <div class="table-container" id="tablaContainer">
Â  Â  Â  <div class="table-wrapper">
Â  Â  Â  Â  <table id="tabla">
Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  <th>#</th>
Â  Â  Â  Â  Â  Â  Â  <th>Fecha</th>
Â  Â  Â  Â  Â  Â  Â  <th>Promotor</th>
Â  Â  Â  Â  Â  Â  Â  <th>TelÃ©fono</th>
Â  Â  Â  Â  Â  Â  Â  <th>ICC</th>
Â  Â  Â  Â  Â  Â  Â  <th>Estado</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  </div>
Â  Â  Â  <div class="loader" id="tablaLoader">
Â  Â  Â  Â  <div class="spinner"></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="charts-container" id="graficasContainer" style="display: none;">
Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  <h3 class="chart-title">
Â  Â  Â  Â  Â  <i>ğŸ“Š</i> Productividad por Promotor
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  <canvas id="graficaProductividad"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  <h3 class="chart-title">
Â  Â  Â  Â  Â  <i>ğŸ“…</i> Portabilidades por DÃ­a
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  <canvas id="graficaTemporal"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  <h3 class="chart-title">
Â  Â  Â  Â  Â  <i>ğŸ“ˆ</i> Tendencias Mensuales
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  <canvas id="graficaTendencias"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  <h3 class="chart-title">
Â  Â  Â  Â  Â  <i>ğŸ¥‡</i> Ranking de Promotores
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  <canvas id="graficaRanking"></canvas>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <footer>
Â  Â  <p>Servicios Integrales MADA &copy; 2023 - Dashboard del Supervisor</p>
Â  </footer>

Â  Â  <div class="toast" id="toast">
Â  Â  <div class="toast-icon" id="toastIcon">âœ…</div>
Â  Â  <div class="toast-message" id="toastMessage">OperaciÃ³n completada con Ã©xito</div>
Â  </div>

Â  <script>
Â  Â  // ConfiguraciÃ³n
Â  Â  const SHEET_ID = "1KJZNzGfbPNBBfjH_SIiuXDBVL6Kj_fO_tz5wt-5_PwM";
Â  Â  const HOJA = "TRAMITES";
Â  Â  const API_URL = `https://opensheet.elk.sh/${SHEET_ID}/${HOJA}`;

Â  Â  // Variables globales
Â  Â  let datosOriginales = [];
Â  Â  let datosFiltrados = [];
Â  Â  let graficas = {};
Â  Â  let promotores = [];

Â  Â  // Elementos DOM
Â  Â  const elementos = {
Â  Â  Â  tabla: document.querySelector("#tabla tbody"),
Â  Â  Â  filtroPromotor: document.getElementById("filtroPromotor"),
Â  Â  Â  filtroEstado: document.getElementById("filtroEstado"),
Â  Â  Â  fechaInicio: document.getElementById("fechaInicio"),
Â  Â  Â  fechaFin: document.getElementById("fechaFin"),
Â  Â  Â  btnFiltrar: document.getElementById("btnFiltrar"),
Â  Â  Â  btnLimpiar: document.getElementById("btnLimpiar"),
Â  Â  Â  btnActualizar: document.getElementById("btnActualizar"),
Â  Â  Â  btnExportar: document.getElementById("btnExportar"),
Â  Â  Â  tabs: document.querySelectorAll(".tab"),
Â  Â  Â  tablaContainer: document.getElementById("tablaContainer"),
Â  Â  Â  graficasContainer: document.getElementById("graficasContainer"),
Â  Â  Â  tablaLoader: document.getElementById("tablaLoader"),
Â  Â  Â  totalPortabilidades: document.getElementById("totalPortabilidades"),
Â  Â  Â  promedioDiario: document.getElementById("promedioDiario"),
Â  Â  Â  promotoresActivos: document.getElementById("promotoresActivos"),
Â  Â  Â  eficiencia: document.getElementById("eficiencia"),
Â  Â  Â  toast: document.getElementById("toast"),
Â  Â  Â  toastIcon: document.getElementById("toastIcon"),
Â  Â  Â  toastMessage: document.getElementById("toastMessage")
Â  Â  };

Â  Â  // InicializaciÃ³n
Â  Â  document.addEventListener('DOMContentLoaded', function() {
Â  Â  Â  // Establecer fechas por defecto (Ãºltimos 30 dÃ­as)
Â  Â  Â  const hoy = new Date();
Â  Â  Â  const hace30Dias = new Date();
Â  Â  Â  hace30Dias.setDate(hoy.getDate() - 30);
Â  Â  Â Â 
Â  Â  Â  elementos.fechaInicio.value = formatearFecha(hace30Dias);
Â  Â  Â  elementos.fechaFin.value = formatearFecha(hoy);
Â  Â  Â Â 
Â  Â  Â  // Cargar datos
Â  Â  Â  cargarDatos();
Â  Â  Â Â 
Â  Â  Â  // Configurar event listeners
Â  Â  Â  configurarEventListeners();
Â  Â  });

Â  Â  // Configurar event listeners
Â  Â  function configurarEventListeners() {
Â  Â  Â  elementos.btnFiltrar.addEventListener("click", aplicarFiltros);
Â  Â  Â  elementos.btnLimpiar.addEventListener("click", limpiarFiltros);
Â  Â  Â  elementos.btnActualizar.addEventListener("click", cargarDatos);
Â  Â  Â  elementos.btnExportar.addEventListener("click", exportarDatos);
Â  Â  Â Â 
Â  Â  Â  // Tabs
Â  Â  Â  elementos.tabs.forEach(tab => {
Â  Â  Â  Â  tab.addEventListener("click", function() {
Â  Â  Â  Â  Â  // Remover clase activa de todas las pestaÃ±as
Â  Â  Â  Â  Â  elementos.tabs.forEach(t => t.classList.remove('active'));
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Agregar clase activa a la pestaÃ±a clickeada
Â  Â  Â  Â  Â  this.classList.add('active');
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Mostrar el contenido correspondiente
Â  Â  Â  Â  Â  const tabId = this.getAttribute('data-tab');
Â  Â  Â  Â  Â  if (tabId === 'tabla') {
Â  Â  Â  Â  Â  Â  elementos.tablaContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  elementos.graficasContainer.style.display = 'none';
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  elementos.tablaContainer.style.display = 'none';
Â  Â  Â  Â  Â  Â  elementos.graficasContainer.style.display = 'grid';
Â  Â  Â  Â  Â  Â  // Inicializar grÃ¡ficas si no existen
Â  Â  Â  Â  Â  Â  if (Object.keys(graficas).length === 0) {
Â  Â  Â  Â  Â  Â  Â  inicializarGraficas();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  actualizarTodasLasGraficas();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  // Cargar todos los datos
Â  Â  async function cargarDatos() {
Â  Â  Â  mostrarLoader();
Â  Â  Â Â 
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(API_URL);
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Procesar datos reales de la hoja
Â  Â  Â  Â  datosOriginales = data.map((fila, index) => {
Â  Â  Â  Â  Â  // Normalizar datos para evitar problemas con mayÃºsculas y acentos
Â  Â  Â  Â  Â  let promotor = fila.Promotor || '';
Â  Â  Â  Â  Â  promotor = normalizarTexto(promotor);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Procesar fecha - manejar diferentes formatos
Â  Â  Â  Â  Â  let fechaOriginal = fila.Fecha || '';
Â  Â  Â  Â  Â  let fechaProcesada = procesarFecha(fechaOriginal);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Obtener telÃ©fono e ICC
Â  Â  Â  Â  Â  let telefono = fila.Telefono || '';
Â  Â  Â  Â  Â  let icc = fila.ICC || '';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  id: index + 1,
Â  Â  Â  Â  Â  Â  fecha: fechaProcesada, // Fecha procesada para mostrar (YYYY-MM-DD)
Â  Â  Â  Â  Â  Â  // Se aÃ±ade T00:00:00 para asegurar que la fecha se interprete como UTC al inicio del dÃ­a.
Â  Â  Â  Â  Â  Â  fechaFiltro: new Date(fechaProcesada + 'T00:00:00'), // Fecha para filtrar
Â  Â  Â  Â  Â  Â  promotor: promotor,
Â  Â  Â  Â  Â  Â  telefono: telefono,
Â  Â  Â  Â  Â  Â  icc: icc,
Â  Â  Â  Â  Â  Â  estado: "LISTO" // Todos los estados son "LISTO"
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Inicializar datos filtrados con todos los datos
Â  Â  Â  Â  datosFiltrados = [...datosOriginales];
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Actualizar la interfaz
Â  Â  Â  Â  llenarPromotores();
Â  Â  Â  Â  actualizarEstadisticas();
Â  Â  Â  Â  llenarTabla();
Â  Â  Â  Â Â 
Â  Â  Â  Â  ocultarLoader();
Â  Â  Â  Â  mostrarToast("Datos cargados correctamente", "success");
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Error al cargar los datos:", error);
Â  Â  Â  Â  ocultarLoader();
Â  Â  Â  Â  mostrarToast("Error al cargar los datos", "error");
Â  Â  Â  }
Â  Â  }

Â  Â  // Normalizar texto para eliminar problemas con mayÃºsculas y acentos
Â  Â  function normalizarTexto(texto) {
Â  Â  Â  if (!texto) return '';
Â  Â  Â  return texto
Â  Â  Â  Â  .normalize("NFD")
Â  Â  Â  Â  .replace(/[\u0300-\u036f]/g, "")
Â  Â  Â  Â  .toLowerCase()
Â  Â  Â  Â  .replace(/\b\w/g, l => l.toUpperCase()); // Capitalizar primera letra de cada palabra
Â  Â  }

    /**
     * @description Procesa una cadena de fecha para devolverla en formato YYYY-MM-DD
     * para asegurar la correcta creaciÃ³n del objeto Date sin problemas de zona horaria.
     */
Â  Â  function procesarFecha(fechaStr) {
Â  Â  Â  if (!fechaStr) return new Date().toISOString().split('T')[0];
Â  Â  Â Â 
Â  Â  Â  let fecha = new Date(fechaStr);
Â  Â  Â Â 
Â  Â  Â  // Si new Date() no puede parsear correctamente, intentar formatos comunes
Â  Â  Â  if (isNaN(fecha.getTime())) {
Â  Â  Â  Â  // Intenta formato DD/MM/YYYY o DD-MM-YYYY (comÃºn en espaÃ±ol)
Â  Â  Â  Â  const partes = fechaStr.match(/^(\d{1,2})[/-](\d{1,2})[/-](\d{4})(.*)$/);
Â  Â  Â  Â  if (partes && partes.length >= 4) {
Â  Â  Â  Â  Â  // Date(aÃ±o, mes(0-11), dÃ­a)
Â  Â  Â  Â  Â  fecha = new Date(partes[3], partes[2] - 1, partes[1]); 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Intenta formato YYYY-MM-DD HH:MM:SS (tÃ­pico de bases de datos/Google Sheets)
Â  Â  Â  Â  Â  const partesGSheet = fechaStr.match(/^(\d{4})[/-](\d{1,2})[/-](\d{1,2})(.*)$/);
Â  Â  Â  Â  Â  if (partesGSheet && partesGSheet.length >= 4) {
Â  Â  Â  Â  Â  Â  // Date(aÃ±o, mes(0-11), dÃ­a)
Â  Â  Â  Â  Â  Â  fecha = new Date(partesGSheet[1], partesGSheet[2] - 1, partesGSheet[3]); 
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Si aÃºn no es vÃ¡lida, usar fecha actual
Â  Â  Â  Â  if (isNaN(fecha.getTime())) {
Â  Â  Â  Â  Â  fecha = new Date();
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  // Devolver siempre en formato YYYY-MM-DD
Â  Â  Â  return fecha.toISOString().split('T')[0];
Â  Â  }

Â  Â  // Llenar select de promotores sin duplicados
Â  Â  function llenarPromotores() {
Â  Â  Â  promotores = [...new Set(datosOriginales.map(r => r.promotor).filter(Boolean))];
Â  Â  Â  elementos.filtroPromotor.innerHTML = "<option value=''>Todos los promotores</option>";
Â  Â  Â  promotores.forEach(p => {
Â  Â  Â  Â  const opt = document.createElement("option");
Â  Â  Â  Â  opt.value = p;
Â  Â  Â  Â  opt.textContent = p;
Â  Â  Â  Â  elementos.filtroPromotor.appendChild(opt);
Â  Â  Â  });
Â  Â  }

Â  Â  // Aplicar filtros
Â  Â  function aplicarFiltros() {
Â  Â  Â  const inicioStr = elementos.fechaInicio.value;
Â  Â  Â  const finStr = elementos.fechaFin.value;
Â  Â  Â  const promSel = elementos.filtroPromotor.value;
Â  Â  Â  const estadoSel = elementos.filtroEstado.value;
Â  Â  Â Â 
Â  Â  Â  let filtrados = datosOriginales;

Â  Â  Â  if (inicioStr) {
Â  Â  Â  Â  // Usar la propiedad fechaFiltro (que es un objeto Date en UTC)
Â  Â  Â  Â  const inicioDate = new Date(inicioStr + 'T00:00:00');
Â  Â  Â  Â  filtrados = filtrados.filter(r => r.fechaFiltro >= inicioDate);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (finStr) {
Â  Â  Â  Â  // Sumar un dÃ­a a la fecha de fin para incluir el dÃ­a completo
Â  Â  Â  Â  const finDate = new Date(finStr + 'T00:00:00');
Â  Â  Â  Â  finDate.setDate(finDate.getDate() + 1); 
Â  Â  Â  Â  filtrados = filtrados.filter(r => r.fechaFiltro < finDate);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (promSel) {
Â  Â  Â  Â  filtrados = filtrados.filter(r => normalizarTexto(r.promotor) === normalizarTexto(promSel));
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (estadoSel) {
Â  Â  Â  Â  filtrados = filtrados.filter(r => r.estado === estadoSel);
Â  Â  Â  }

Â  Â  Â  datosFiltrados = filtrados;
Â  Â  Â Â 
Â  Â  Â  // Actualizar la interfaz
Â  Â  Â  actualizarEstadisticas();
Â  Â  Â  llenarTabla();
Â  Â  Â  actualizarTodasLasGraficas();
Â  Â  Â Â 
Â  Â  Â  mostrarToast(`Filtros aplicados: ${datosFiltrados.length} registros encontrados`, "success");
Â  Â  }

Â  Â  // Limpiar filtros
Â  Â  function limpiarFiltros() {
Â  Â  Â  // Restablecer fechas a los Ãºltimos 30 dÃ­as
Â  Â  Â  const hoy = new Date();
Â  Â  Â  const hace30Dias = new Date();
Â  Â  Â  hace30Dias.setDate(hoy.getDate() - 30);
Â  Â  Â Â 
Â  Â  Â  elementos.fechaInicio.value = formatearFecha(hace30Dias);
Â  Â  Â  elementos.fechaFin.value = formatearFecha(hoy);
Â  Â  Â  elementos.filtroPromotor.value = '';
Â  Â  Â  elementos.filtroEstado.value = '';
Â  Â  Â Â 
Â  Â  Â  // Restablecer datos filtrados a todos los datos
Â  Â  Â  datosFiltrados = [...datosOriginales];
Â  Â  Â Â 
Â  Â  Â  // Actualizar la interfaz
Â  Â  Â  actualizarEstadisticas();
Â  Â  Â  llenarTabla();
Â  Â  Â  actualizarTodasLasGraficas();
Â  Â  Â Â 
Â  Â  Â  mostrarToast("Filtros limpiados correctamente", "success");
Â  Â  }

Â  Â  // Llenar tabla
Â  Â  function llenarTabla() {
Â  Â  Â  elementos.tabla.innerHTML = "";
Â  Â  Â Â 
Â  Â  Â  if (datosFiltrados.length === 0) {
Â  Â  Â  Â  elementos.tabla.innerHTML = `
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td colspan="6" style="text-align: center; padding: 2rem;">
Â  Â  Â  Â  Â  Â  Â  No se encontraron registros con los filtros aplicados.
Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  `;
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  datosFiltrados.forEach(fila => {
Â  Â  Â  Â  const tr = document.createElement("tr");
Â  Â  Â  Â Â 
Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  <td>${fila.id}</td>
Â  Â  Â  Â  Â  <td>${formatearFechaParaTabla(fila.fecha)}</td>
Â  Â  Â  Â  Â  <td>${fila.promotor}</td>
Â  Â  Â  Â  Â  <td>${fila.telefono}</td>
Â  Â  Â  Â  Â  <td>${fila.icc}</td>
Â  Â  Â  Â  Â  <td><span class="status-badge status-completed">LISTO</span></td>
Â  Â  Â  Â  `;
Â  Â  Â  Â  elementos.tabla.appendChild(tr);
Â  Â  Â  });
Â  Â  }

Â  Â  // Actualizar estadÃ­sticas
Â  Â  function actualizarEstadisticas() {
Â  Â  Â  // Total de portabilidades
Â  Â  Â  elementos.totalPortabilidades.textContent = datosFiltrados.length;
Â  Â  Â Â 
Â  Â  Â  // Promedio diario
Â  Â  Â  if (datosFiltrados.length > 0) {
Â  Â  Â  Â  const fechasUnicas = [...new Set(datosFiltrados.map(r => r.fecha))];
Â  Â  Â  Â  const promedio = (datosFiltrados.length / fechasUnicas.length).toFixed(1);
Â  Â  Â  Â  elementos.promedioDiario.textContent = promedio;
Â  Â  Â  } else {
Â  Â  Â  Â  elementos.promedioDiario.textContent = '0';
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  // Promotores activos
Â  Â  Â  const promotoresUnicos = [...new Set(datosFiltrados.map(r => r.promotor))];
Â  Â  Â  elementos.promotoresActivos.textContent = promotoresUnicos.length;
Â  Â  Â Â 
Â  Â  Â  // Eficiencia (calculada basada en datos reales)
Â  Â  Â  const eficienciaCalculada = calcularEficiencia();
Â  Â  Â  elementos.eficiencia.textContent = `${eficienciaCalculada}%`;
Â  Â  }

Â  Â  // Calcular eficiencia basada en datos reales
Â  Â  function calcularEficiencia() {
Â  Â  Â  if (datosFiltrados.length === 0) return 0;
Â  Â  Â Â 
Â  Â  Â  // Calcular eficiencia basada en la distribuciÃ³n de portabilidades por promotor
Â  Â  Â  const conteoPorPromotor = {};
Â  Â  Â  datosFiltrados.forEach(r => {
Â  Â  Â  Â  const prom = r.promotor;
Â  Â  Â  Â  conteoPorPromotor[prom] = (conteoPorPromotor[prom] || 0) + 1;
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  const valores = Object.values(conteoPorPromotor);
Â  Â  Â  if (valores.length <= 1) return 100; // Si solo hay un promotor o ninguno, es 100% (o 0%)
Â  Â  Â  
Â  Â  Â  const max = Math.max(...valores);
Â  Â  Â  const min = Math.min(...valores);
Â  Â  Â Â 
Â  Â  Â  // Calcular un Ã­ndice de eficiencia basado en la distribuciÃ³n
Â  Â  Â  if (max === min) return 100; // Todos igualmente productivos
Â  Â  Â Â 
Â  Â  Â  const eficiencia = 70 + (30 * (1 - (max - min) / max));
Â  Â  Â  return Math.min(100, Math.max(70, Math.round(eficiencia)));
Â  Â  }

Â  Â  // Inicializar grÃ¡ficas
Â  Â  function inicializarGraficas() {
Â  Â  Â  // GrÃ¡fica de productividad por promotor
Â  Â  Â  const ctxProductividad = document.getElementById('graficaProductividad').getContext('2d');
Â  Â  Â  graficas.productividad = new Chart(ctxProductividad, {
Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  labels: [],
Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  label: 'Portabilidades',
Â  Â  Â  Â  Â  Â  data: [],
Â  Â  Â  Â  Â  Â  backgroundColor: '#3b82f6',
Â  Â  Â  Â  Â  Â  borderColor: '#2563eb',
Â  Â  Â  Â  Â  Â  borderWidth: 1
Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: { display: false },
Â  Â  Â  Â  Â  Â  title: { display: true, text: 'Productividad por Promotor' }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  y: {
Â  Â  Â  Â  Â  Â  Â  beginAtZero: true,
Â  Â  Â  Â  Â  Â  Â  ticks: { stepSize: 1 }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // GrÃ¡fica temporal (portabilidades por dÃ­a)
Â  Â  Â  const ctxTemporal = document.getElementById('graficaTemporal').getContext('2d');
Â  Â  Â  graficas.temporal = new Chart(ctxTemporal, {
Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  labels: [],
Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  label: 'Portabilidades',
Â  Â  Â  Â  Â  Â  data: [],
Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(14, 165, 233, 0.1)',
Â  Â  Â  Â  Â  Â  borderColor: '#0ea5e9',
Â  Â  Â  Â  Â  Â  borderWidth: 2,
Â  Â  Â  Â  Â  Â  tension: 0.3,
Â  Â  Â  Â  Â  Â  fill: true
Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: { display: false }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  y: {
Â  Â  Â  Â  Â  Â  Â  beginAtZero: true
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // GrÃ¡fica de tendencias mensuales
Â  Â  Â  const ctxTendencias = document.getElementById('graficaTendencias').getContext('2d');
Â  Â  Â  graficas.tendencias = new Chart(ctxTendencias, {
Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
Â  Â  Â  Â  Â  datasets: [
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  label: '2023',
Â  Â  Â  Â  Â  Â  Â  data: [12, 19, 15, 17, 14, 16, 18, 20, 22, 19, 21, 23],
Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(37, 99, 235, 0.7)',
Â  Â  Â  Â  Â  Â  Â  borderColor: '#2563eb',
Â  Â  Â  Â  Â  Â  Â  borderWidth: 1
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  label: '2022',
Â  Â  Â  Â  Â  Â  Â  data: [10, 12, 14, 13, 11, 15, 16, 14, 17, 15, 16, 18],
Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(14, 165, 233, 0.7)',
Â  Â  Â  Â  Â  Â  Â  borderColor: '#0ea5e9',
Â  Â  Â  Â  Â  Â  Â  borderWidth: 1
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: {
Â  Â  Â  Â  Â  Â  Â  position: 'top'
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // GrÃ¡fica de ranking (horizontal bar)
Â  Â  Â  const ctxRanking = document.getElementById('graficaRanking').getContext('2d');
Â  Â  Â  graficas.ranking = new Chart(ctxRanking, {
Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  labels: [],
Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  label: 'Portabilidades',
Â  Â  Â  Â  Â  Â  data: [],
Â  Â  Â  Â  Â  Â  backgroundColor: [
Â  Â  Â  Â  Â  Â  Â  '#3b82f6', '#0ea5e9', '#10b981', '#f59e0b', '#ef4444',
Â  Â  Â  Â  Â  Â  Â  '#8b5cf6', '#ec4899', '#f97316', '#84cc16', '#64748b'
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  indexAxis: 'y',
Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: { display: false }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // Actualizar todas las grÃ¡ficas con datos iniciales
Â  Â  Â  actualizarTodasLasGraficas();
Â  Â  }

Â  Â  // Actualizar todas las grÃ¡ficas
Â  Â  function actualizarTodasLasGraficas() {
Â  Â  Â  if (Object.keys(graficas).length === 0) return;
Â  Â  Â  actualizarGraficaProductividad();
Â  Â  Â  actualizarGraficaTemporal();
Â  Â  Â  actualizarGraficaRanking();
Â  Â  }

Â  Â  // Actualizar grÃ¡fica de productividad
Â  Â  function actualizarGraficaProductividad() {
Â  Â  Â  if (!graficas.productividad) return;
Â  Â  Â Â 
Â  Â  Â  const conteo = {};
Â  Â  Â  datosFiltrados.forEach(r => {
Â  Â  Â  Â  const prom = r.promotor;
Â  Â  Â  Â  conteo[prom] = (conteo[prom] || 0) + 1;
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  const labels = Object.keys(conteo);
Â  Â  Â  const valores = Object.values(conteo);
Â  Â  Â Â 
Â  Â  Â  graficas.productividad.data.labels = labels;
Â  Â  Â  graficas.productividad.data.datasets[0].data = valores;
Â  Â  Â  graficas.productividad.update();
Â  Â  }

Â  Â  // Actualizar grÃ¡fica temporal
Â  Â  function actualizarGraficaTemporal() {
Â  Â  Â  if (!graficas.temporal) return;
Â  Â  Â Â 
Â  Â  Â  // Agrupar por fecha
Â  Â  Â  const conteoPorFecha = {};
Â  Â  Â  datosFiltrados.forEach(r => {
Â  Â  Â  Â  const fecha = r.fecha;
Â  Â  Â  Â  conteoPorFecha[fecha] = (conteoPorFecha[fecha] || 0) + 1;
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // Ordenar por fecha
Â  Â  Â  const fechasOrdenadas = Object.keys(conteoPorFecha).sort();
Â  Â  Â  const valoresOrdenados = fechasOrdenadas.map(fecha => conteoPorFecha[fecha]);
Â  Â  Â Â 
Â  Â  Â  graficas.temporal.data.labels = fechasOrdenadas.map(f => formatearFechaParaTabla(f));
Â  Â  Â  graficas.temporal.data.datasets[0].data = valoresOrdenados;
Â  Â  Â  graficas.temporal.update();
Â  Â  }

Â  Â  // Actualizar grÃ¡fica de ranking
Â  Â  function actualizarGraficaRanking() {
Â  Â  Â  if (!graficas.ranking) return;
Â  Â  Â Â 
Â  Â  Â  const conteo = {};
Â  Â  Â  datosFiltrados.forEach(r => {
Â  Â  Â  Â  const prom = r.promotor;
Â  Â  Â  Â  conteo[prom] = (conteo[prom] || 0) + 1;
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  // Ordenar por cantidad (descendente)
Â  Â  Â  const entries = Object.entries(conteo);
Â  Â  Â  entries.sort((a, b) => b[1] - a[1]);
Â  Â  Â Â 
Â  Â  Â  // Tomar los primeros 10
Â  Â  Â  const top10 = entries.slice(0, 10);
Â  Â  Â Â 
Â  Â  Â  const labels = top10.map(entry => entry[0]);
Â  Â  Â  const valores = top10.map(entry => entry[1]);
Â  Â  Â Â 
Â  Â  Â  graficas.ranking.data.labels = labels;
Â  Â  Â  graficas.ranking.data.datasets[0].data = valores;
Â  Â  Â  graficas.ranking.update();
Â  Â  }

Â  Â  // Exportar datos a Excel
Â  Â  function exportarDatos() {
Â  Â  Â  if (datosFiltrados.length === 0) {
Â  Â  Â  Â  mostrarToast("No hay datos para exportar", "error");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  try {
Â  Â  Â  Â  // Preparar datos para exportaciÃ³n
Â  Â  Â  Â  const datosExportar = datosFiltrados.map(fila => ({
Â  Â  Â  Â  Â  ID: fila.id,
Â  Â  Â  Â  Â  Fecha: formatearFechaParaTabla(fila.fecha),
Â  Â  Â  Â  Â  Promotor: fila.promotor,
Â  Â  Â  Â  Â  TelÃ©fono: fila.telefono,
Â  Â  Â  Â  Â  ICC: fila.icc,
Â  Â  Â  Â  Â  Estado: fila.estado
Â  Â  Â  Â  }));
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Crear libro de trabajo
Â  Â  Â  Â  const wb = XLSX.utils.book_new();
Â  Â  Â  Â  const ws = XLSX.utils.json_to_sheet(datosExportar);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // AÃ±adir hoja al libro
Â  Â  Â  Â  XLSX.utils.book_append_sheet(wb, ws, "Portabilidades");
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Generar nombre de archivo con fecha
Â  Â  Â  Â  const fechaHoy = new Date().toISOString().split('T')[0];
Â  Â  Â  Â  const nombreArchivo = `Portabilidades_${fechaHoy}.xlsx`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Descargar archivo
Â  Â  Â  Â  XLSX.writeFile(wb, nombreArchivo);
Â  Â  Â  Â Â 
Â  Â  Â  Â  mostrarToast(`Datos exportados correctamente: ${nombreArchivo}`, "success");
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Error al exportar datos:", error);
Â  Â  Â  Â  mostrarToast("Error al exportar los datos", "error");
Â  Â  Â  }
Â  Â  }

Â  Â  // Mostrar notificaciÃ³n toast
Â  Â  function mostrarToast(mensaje, tipo = "success") {
Â  Â  Â  elementos.toast.className = `toast toast-${tipo}`;
Â  Â  Â  elementos.toastMessage.textContent = mensaje;
Â  Â  Â  elementos.toastIcon.textContent = tipo === "success" ? "âœ…" : "âŒ";
Â  Â  Â Â 
Â  Â  Â  elementos.toast.classList.add("show");
Â  Â  Â Â 
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  elementos.toast.classList.remove("show");
Â  Â  Â  }, 3000);
Â  Â  }

Â  Â  // Utilidades
Â  Â  function formatearFecha(fecha) {
Â  Â  Â  return fecha.toISOString().split('T')[0];
Â  Â  }

    /**
     * @description Formatea una cadena de fecha YYYY-MM-DD a DD/MM/YYYY para la tabla.
     * AÃ±ade T00:00:00 para evitar desvÃ­os por zona horaria.
     */
Â  Â  function formatearFechaParaTabla(fechaStr) {
Â  Â  Â  if (!fechaStr) return '';
Â  Â  Â Â 
Â  Â  Â  try {
Â  Â  Â  Â  // Asumimos que fechaStr viene en formato YYYY-MM-DD (del procesarFecha)
Â  Â  Â  Â  // AÃ±adimos 'T00:00:00' para que se interprete como medianoche UTC, 
Â  Â  Â  Â  // previniendo que la hora local lo mueva al dÃ­a anterior.
Â  Â  Â  Â  const fecha = new Date(fechaStr + 'T00:00:00'); 
Â  Â  Â  Â  const opciones = { day: '2-digit', month: '2-digit', year: 'numeric' };
Â  Â  Â  Â  return fecha.toLocaleDateString('es-ES', opciones);
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  return fechaStr;
Â  Â  Â  }
Â  Â  }

Â  Â  function mostrarLoader() {
Â  Â  Â  elementos.tablaLoader.style.display = 'flex';
Â  Â  }

Â  Â  function ocultarLoader() {
Â  Â  Â  elementos.tablaLoader.style.display = 'none';
Â  Â  }
Â  </script>
</body>
</html>
