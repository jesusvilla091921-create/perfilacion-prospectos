<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Dashboard Supervisor | Servicios Integrales MADA</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
Â  Â  <style>
Â  Â  Â  Â  /* CSS Optimizado y Mejor Organizado */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary-color: #2563eb;
Â  Â  Â  Â  Â  Â  --success-color: #10b981;
Â  Â  Â  Â  Â  Â  --warning-color: #f59e0b;
Â  Â  Â  Â  Â  Â  --danger-color: #ef4444;
Â  Â  Â  Â  Â  Â  --gray-100: #f3f4f6;
Â  Â  Â  Â  Â  Â  --gray-200: #e5e7eb;
Â  Â  Â  Â  Â  Â  --gray-300: #d1d5db;
Â  Â  Â  Â  Â  Â  --gray-700: #374151;
Â  Â  Â  Â  Â  Â  --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
Â  Â  Â  Â  Â  Â  --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  --transition: all 0.3s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f8fafc;
Â  Â  Â  Â  Â  Â  color: #1e293b;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 1.5rem 2rem;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-md);
Â  Â  Â  Â  Â  Â  position: sticky;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header-content {
Â  Â  Â  Â  Â  Â  max-width: 1400px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  gap: 1rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .main-container {
Â  Â  Â  Â  Â  Â  max-width: 1400px;
Â  Â  Â  Â  Â  Â  margin: 2rem auto;
Â  Â  Â  Â  Â  Â  padding: 0 2rem;
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  gap: 1.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .stats-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 1.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .stat-card {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-sm);
Â  Â  Â  Â  Â  Â  transition: var(--transition);
Â  Â  Â  Â  Â  Â  border-left: 4px solid var(--primary-color);
Â  Â  Â  Â  }

Â  Â  Â  Â  .stat-card:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-md);
Â  Â  Â  Â  }

Â  Â  Â  Â  .stat-card.success { border-left-color: var(--success-color); }
Â  Â  Â  Â  .stat-card.warning { border-left-color: var(--warning-color); }
Â  Â  Â  Â  .stat-card.danger { border-left-color: var(--danger-color); }

Â  Â  Â  Â  .stat-value {
Â  Â  Â  Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  margin: 0.5rem 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filters-container {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-sm);
Â  Â  Â  Â  }

Â  Â  Â  Â  .filters-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 1rem;
Â  Â  Â  Â  Â  Â  align-items: end;
Â  Â  Â  Â  }

Â  Â  Â  Â  .form-group {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  label {
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  Â  Â  Â  color: var(--gray-700);
Â  Â  Â  Â  }

Â  Â  Â  Â  select, input {
Â  Â  Â  Â  Â  Â  padding: 0.75rem;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--gray-300);
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  font-size: 1rem;
Â  Â  Â  Â  Â  Â  transition: var(--transition);
Â  Â  Â  Â  }

Â  Â  Â  Â  select:focus, input:focus {
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  border-color: var(--primary-color);
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: var(--transition);
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-primary {
Â  Â  Â  Â  Â  Â  background-color: var(--primary-color);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-primary:hover {
Â  Â  Â  Â  Â  Â  background-color: #1d4ed8;
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-secondary {
Â  Â  Â  Â  Â  Â  background-color: var(--gray-200);
Â  Â  Â  Â  Â  Â  color: var(--gray-700);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-secondary:hover {
Â  Â  Â  Â  Â  Â  background-color: var(--gray-300);
Â  Â  Â  Â  }

Â  Â  Â  Â  .tabs {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--gray-200);
Â  Â  Â  Â  Â  Â  padding-bottom: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-btn {
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  Â  Â  Â  background: none;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px 8px 0 0;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: var(--gray-700);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: var(--transition);
Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-btn.active {
Â  Â  Â  Â  Â  Â  background-color: var(--primary-color);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .tab-btn:hover:not(.active) {
Â  Â  Â  Â  Â  Â  background-color: var(--gray-100);
Â  Â  Â  Â  }

Â  Â  Â  Â  .table-container {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-sm);
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  min-height: 400px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .table-wrapper {
Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  }

Â  Â  Â  Â  table {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  Â  Â  min-width: 800px;
Â  Â  Â  Â  }

Â  Â  Â  Â  thead {
Â  Â  Â  Â  Â  Â  background-color: var(--gray-100);
Â  Â  Â  Â  Â  Â  position: sticky;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  th {
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: var(--gray-700);
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--gray-200);
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  }

Â  Â  Â  Â  td {
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--gray-200);
Â  Â  Â  Â  }

Â  Â  Â  Â  tr:hover {
Â  Â  Â  Â  Â  Â  background-color: var(--gray-100);
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge {
Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge-success {
Â  Â  Â  Â  Â  Â  background-color: #d1fae5;
Â  Â  Â  Â  Â  Â  color: #065f46;
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge-warning {
Â  Â  Â  Â  Â  Â  background-color: #fef3c7;
Â  Â  Â  Â  Â  Â  color: #92400e;
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge-danger {
Â  Â  Â  Â  Â  Â  background-color: #fee2e2;
Â  Â  Â  Â  Â  Â  color: #991b1b;
Â  Â  Â  Â  }

Â  Â  Â  Â  .loader {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.9);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }

Â  Â  Â  Â  .spinner {
Â  Â  Â  Â  Â  Â  width: 50px;
Â  Â  Â  Â  Â  Â  height: 50px;
Â  Â  Â  Â  Â  Â  border: 3px solid var(--gray-200);
Â  Â  Â  Â  Â  Â  border-top-color: var(--primary-color);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes spin {
Â  Â  Â  Â  Â  Â  to { transform: rotate(360deg); }
Â  Â  Â  Â  }

Â  Â  Â  Â  .charts-container {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 1.5rem;
Â  Â  Â  Â  Â  Â  margin-top: 1.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .chart-card {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-sm);
Â  Â  Â  Â  }

Â  Â  Â  Â  .toast {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  bottom: 2rem;
Â  Â  Â  Â  Â  Â  right: 2rem;
Â  Â  Â  Â  Â  Â  padding: 1rem 1.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  transform: translateY(100px);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transition: var(--transition);
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  }

Â  Â  Â  Â  .toast.show {
Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  .toast-success {
Â  Â  Â  Â  Â  Â  background-color: var(--success-color);
Â  Â  Â  Â  }

Â  Â  Â  Â  .toast-error {
Â  Â  Â  Â  Â  Â  background-color: var(--danger-color);
Â  Â  Â  Â  }

Â  Â  Â  Â  .footer {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  color: var(--gray-700);
Â  Â  Â  Â  Â  Â  margin-top: 3rem;
Â  Â  Â  Â  Â  Â  border-top: 1px solid var(--gray-200);
Â  Â  Â  Â  }

Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .main-container {
Â  Â  Â  Â  Â  Â  Â  Â  padding: 0 1rem;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .header-content {
Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .charts-container {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .tabs {
Â  Â  Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  Â  Â  Â  Â  flex-wrap: nowrap;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <header class="header">
Â  Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  Â  Â  <h1>Dashboard Supervisor</h1>
Â  Â  Â  Â  Â  Â  <div class="header-info">
Â  Â  Â  Â  Â  Â  Â  Â  <div>Servicios Integrales MADA</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="fechaActual" class="text-sm"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <main class="main-container">
Â  Â  Â  Â  <div class="stats-grid" id="statsContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="filters-container">
Â  Â  Â  Â  Â  Â  <div class="filters-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="fechaInicio">Fecha Inicio</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="fechaInicio">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="fechaFin">Fecha Fin</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="fechaFin">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="promotorSelect">Promotor</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="promotorSelect">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="todos">Todos los promotores</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="estadoSelect">Estado</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="estadoSelect">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="todos">Todos los estados</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="PENDIENTE">PENDIENTE</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="LISTO">LISTO</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="RECHAZADO">RECHAZADO</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnFiltrar" class="btn btn-primary">Filtrar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnExportar" class="btn btn-secondary">Exportar Excel</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="tabs-container">
Â  Â  Â  Â  Â  Â  <div class="tabs">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="tab-btn active" data-tab="tabla">Tabla de Datos</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="tab-btn" data-tab="graficas">GrÃ¡ficas</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="table-container" id="tablaContainer">
Â  Â  Â  Â  Â  Â  <div class="table-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <table id="tabla">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>#</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Fecha</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Promotor</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>TelÃ©fono</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>ICC</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Estado</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="tablaBody">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="loader" id="tablaLoader">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="spinner"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="charts-container" id="graficasContainer" style="display: none;">
Â  Â  Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>DistribuciÃ³n por Estado</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="chartEstado"></canvas>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Actividad por Promotor</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="chartPromotor"></canvas>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="chart-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Tendencia Diaria</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="chartTendencia"></canvas>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <footer class="footer">
Â  Â  Â  Â  <p>Servicios Integrales MADA &copy; <span id="currentYear"></span> | Dashboard Supervisor v2.0</p>
Â  Â  </footer>

Â  Â  <div class="toast" id="toast"></div>

Â  Â  <script>
Â  Â  Â  Â  // ============ CONFIGURACIÃ“N ============
Â  Â  Â  Â  // ðŸ›‘ REEMPLAZA ESTA URL CON LA URL DE TU APPS SCRIPT
Â  Â  Â  Â  const API_URL = 'REEMPLAZA_CON_TU_URL_APPS_SCRIPT/exec'; 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ============ ESTADO GLOBAL ============
Â  Â  Â  Â  const state = {
Â  Â  Â  Â  Â  Â  datosOriginales: [],
Â  Â  Â  Â  Â  Â  datosFiltrados: [],
Â  Â  Â  Â  Â  Â  graficas: {},
Â  Â  Â  Â  Â  Â  promotores: new Set(),
Â  Â  Â  Â  Â  Â  filtros: {
Â  Â  Â  Â  Â  Â  Â  Â  fechaInicio: null,
Â  Â  Â  Â  Â  Â  Â  Â  fechaFin: null,
Â  Â  Â  Â  Â  Â  Â  Â  promotor: 'todos',
Â  Â  Â  Â  Â  Â  Â  Â  estado: 'todos'
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // ============ CACHE DE ELEMENTOS DOM (sin cambios) ============
Â  Â  Â  Â  const elements = {
Â  Â  Â  Â  Â  Â  tablaBody: document.getElementById('tablaBody'),
Â  Â  Â  Â  Â  Â  tablaLoader: document.getElementById('tablaLoader'),
Â  Â  Â  Â  Â  Â  statsContainer: document.getElementById('statsContainer'),
Â  Â  Â  Â  Â  Â  fechaInicio: document.getElementById('fechaInicio'),
Â  Â  Â  Â  Â  Â  fechaFin: document.getElementById('fechaFin'),
Â  Â  Â  Â  Â  Â  promotorSelect: document.getElementById('promotorSelect'),
Â  Â  Â  Â  Â  Â  estadoSelect: document.getElementById('estadoSelect'),
Â  Â  Â  Â  Â  Â  btnFiltrar: document.getElementById('btnFiltrar'),
Â  Â  Â  Â  Â  Â  btnExportar: document.getElementById('btnExportar'),
Â  Â  Â  Â  Â  Â  tabBtns: document.querySelectorAll('.tab-btn'),
Â  Â  Â  Â  Â  Â  tablaContainer: document.getElementById('tablaContainer'),
Â  Â  Â  Â  Â  Â  graficasContainer: document.getElementById('graficasContainer'),
Â  Â  Â  Â  Â  Â  toast: document.getElementById('toast'),
Â  Â  Â  Â  Â  Â  fechaActual: document.getElementById('fechaActual'),
Â  Â  Â  Â  Â  Â  currentYear: document.getElementById('currentYear')
Â  Â  Â  Â  };

Â  Â  Â  Â  // ============ UTILIDADES (MODIFICADO: NormalizaciÃ³n centralizada) ============
Â  Â  Â  Â  const utils = {
Â  Â  Â  Â  Â  Â  formatearFecha: (fecha) => {
Â  Â  Â  Â  Â  Â  Â  Â  return fecha.toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // NUEVA: Mismo sistema de normalizaciÃ³n que el Apps Script/Registro
Â  Â  Â  Â  Â  Â  normalizarTexto: (texto) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!texto) return '';
Â  Â  Â  Â  Â  Â  Â  Â  return String(texto)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .normalize("NFD")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/[\u0300-\u036f]/g, "") 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .toUpperCase() 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .trim();
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  procesarFecha: (fechaStr) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!fechaStr) return utils.formatearFecha(new Date());
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Permitir que el Apps Script envÃ­e la fecha ya formateada (YYYY-MM-DD)
Â  Â  Â  Â  Â  Â  Â  Â  const fecha = new Date(fechaStr + 'T00:00:00'); 
Â  Â  Â  Â  Â  Â  Â  Â  if (isNaN(fecha.getTime())) return utils.formatearFecha(new Date());
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  return utils.formatearFecha(fecha);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  mostrarToast: (mensaje, tipo = 'success') => {
Â  Â  Â  Â  Â  Â  Â  Â  elements.toast.textContent = mensaje;
Â  Â  Â  Â  Â  Â  Â  Â  elements.toast.className = `toast ${tipo === 'success' ? 'toast-success' : 'toast-error'}`;
Â  Â  Â  Â  Â  Â  Â  Â  elements.toast.classList.add('show');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.toast.classList.remove('show');
Â  Â  Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  mostrarLoader: () => {
Â  Â  Â  Â  Â  Â  Â  Â  elements.tablaLoader.style.display = 'flex';
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  ocultarLoader: () => {
Â  Â  Â  Â  Â  Â  Â  Â  elements.tablaLoader.style.display = 'none';
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  debounce: (func, wait) => {
Â  Â  Â  Â  Â  Â  Â  Â  let timeout;
Â  Â  Â  Â  Â  Â  Â  Â  return function executedFunction(...args) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const later = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timeout);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  func(...args);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timeout);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeout = setTimeout(later, wait);
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // ============ MANEJO DE DATOS ============
Â  Â  Â  Â  const dataHandler = {
Â  Â  Â  Â  Â  Â  async cargarDatos() {
Â  Â  Â  Â  Â  Â  Â  Â  utils.mostrarLoader();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Apps Script devuelve solo el array de objetos, sin necesidad de 'json.result'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(API_URL);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error(`HTTP ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.datosOriginales = data.map((fila, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fechaNormalizada = utils.procesarFecha(fila.Fecha);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const promotorNormalizado = utils.normalizarTexto(fila.Promotor || '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: index + 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fecha: fechaNormalizada,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fechaFiltro: new Date(fechaNormalizada + 'T00:00:00'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  promotor: promotorNormalizado, // Usa el nombre normalizado
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  telefono: String(fila.Telefono || '').trim(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icc: String(fila.ICC || '').trim(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estado: utils.normalizarTexto(fila.Estado || 'PENDIENTE')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.datosFiltrados = [...state.datosOriginales];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extraer promotores Ãºnicos del campo normalizado
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.promotores = new Set(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.datosOriginales.map(item => item.promotor).filter(Boolean)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.actualizarSelectPromotores();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uiHandler.actualizarEstadisticas();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uiHandler.llenarTabla();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  utils.ocultarLoader();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  utils.mostrarToast(`${state.datosOriginales.length} registros cargados`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error al cargar datos:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  utils.ocultarLoader();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  utils.mostrarToast(`Error al cargar datos: ${error.message}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  actualizarSelectPromotores() {
Â  Â  Â  Â  Â  Â  Â  Â  const select = elements.promotorSelect;
Â  Â  Â  Â  Â  Â  Â  Â  select.innerHTML = '<option value="todos">Todos los promotores</option>';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Array.from(state.promotores)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .forEach(promotor => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  option.value = promotor;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = promotor;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  select.appendChild(option);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  aplicarFiltros() {
Â  Â  Â  Â  Â  Â  Â  Â  const { fechaInicio, fechaFin, promotor, estado } = state.filtros;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const fechaInicioObj = fechaInicio ? new Date(fechaInicio + 'T00:00:00') : null;
Â  Â  Â  Â  Â  Â  Â  Â  const fechaFinObj = fechaFin ? new Date(fechaFin + 'T23:59:59') : null;
Â  Â  Â  Â  Â  Â  Â  Â  const promotorFiltro = promotor === 'todos' ? null : promotor;
Â  Â  Â  Â  Â  Â  Â  Â  const estadoFiltro = estado === 'todos' ? null : estado;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  state.datosFiltrados = state.datosOriginales.filter(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Filtro por fecha
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fechaInicioObj && item.fechaFiltro < fechaInicioObj) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fechaFinObj && item.fechaFiltro > fechaFinObj) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Filtro por promotor (ya estÃ¡ normalizado)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (promotorFiltro && item.promotor !== promotorFiltro) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Filtro por estado (ya estÃ¡ normalizado/mayÃºsculas)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (estadoFiltro && item.estado !== estadoFiltro) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  uiHandler.actualizarEstadisticas();
Â  Â  Â  Â  Â  Â  Â  Â  uiHandler.llenarTabla();
Â  Â  Â  Â  Â  Â  Â  Â  // Regenerar grÃ¡ficas si la pestaÃ±a estÃ¡ activa
Â  Â  Â  Â  Â  Â  Â  Â  if (elements.graficasContainer.style.display !== 'none') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uiHandler.inicializarGraficas();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  utils.mostrarToast(`${state.datosFiltrados.length} registros filtrados`, 'success');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  exportarExcel() {
Â  Â  Â  Â  Â  Â  Â  Â  // ... (lÃ³gica de exportaciÃ³n sin cambios)
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ws = XLSX.utils.json_to_sheet(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.datosFiltrados.map(item => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '#': item.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Fecha': item.fecha,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Promotor': item.promotor,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'TelÃ©fono': item.telefono,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'ICC': item.icc,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Estado': item.estado
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const wb = XLSX.utils.book_new();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  XLSX.utils.book_append_sheet(wb, ws, "Datos");
