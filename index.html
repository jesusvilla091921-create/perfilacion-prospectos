<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8" />
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  Â  <title>MADA - Sistema de Registro de Portabilidades</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary: #4f46e5;
Â  Â  Â  Â  Â  Â  --primary-dark: #4338ca;
Â  Â  Â  Â  Â  Â  --primary-light: #6366f1;
Â  Â  Â  Â  Â  Â  --secondary: #0ea5e9;
Â  Â  Â  Â  Â  Â  --accent: #10b981;
Â  Â  Â  Â  Â  Â  --success: #10b981;
Â  Â  Â  Â  Â  Â  --warning: #f59e0b;
Â  Â  Â  Â  Â  Â  --error: #ef4444;
Â  Â  Â  Â  Â  Â  --dark: #0f172a;
Â  Â  Â  Â  Â  Â  --darker: #000000;
Â  Â  Â  Â  Â  Â  --text: #e2e8f0;
Â  Â  Â  Â  Â  Â  --text-light: #94a3b8;
Â  Â  Â  Â  Â  Â  --radius: 12px;
Â  Â  Â  Â  Â  Â  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
Â  Â  Â  Â  Â  Â  --transition: all 0.3s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', system-ui, sans-serif;
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
Â  Â  Â  Â  Â  Â  color: var(--text);
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .app-container {
Â  Â  Â  Â  Â  Â  max-width: 1200px;
Â  Â  Â  Â  Â  Â  margin: 1rem auto;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-lg);
Â  Â  Â  Â  Â  Â  background: var(--dark);
Â  Â  Â  Â  Â  Â  min-height: calc(100vh - 2rem);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .main-content {Â 
Â  Â  Â  Â  Â  Â  padding: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  gap: 1.5rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card {
Â  Â  Â  Â  Â  Â  background: var(--darker);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.05);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-title {
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.75rem;
Â  Â  Â  Â  Â  Â  color: var(--text);
Â  Â  Â  Â  Â  Â  padding-bottom: 0.75rem;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--primary);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-title i { color: var(--primary-light); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .header {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-lg);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .logo-icon {Â 
Â  Â  Â  Â  Â  Â  font-size: 2rem;Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.2);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  width: 60px;Â 
Â  Â  Â  Â  Â  Â  height: 60px;Â 
Â  Â  Â  Â  Â  Â  display: inline-flex;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .company-name {Â 
Â  Â  Â  Â  Â  Â  font-size: 1.8rem;Â 
Â  Â  Â  Â  Â  Â  font-weight: 700;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  Â  Â  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .app-title {Â 
Â  Â  Â  Â  Â  Â  font-size: 1.3rem;Â 
Â  Â  Â  Â  Â  Â  opacity: 0.9;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.25rem;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .system-status {Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;Â 
Â  Â  Â  Â  Â  Â  margin-top: 0.5rem;Â 
Â  Â  Â  Â  Â  Â  color: var(--text);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .form-group {Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 1.2rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .form-label {Â 
Â  Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  Â  Â  font-weight: 500;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.95rem;Â 
Â  Â  Â  Â  Â  Â  color: var(--text-light);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .form-input {
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  padding: 0.9rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  font-size: 1rem;Â 
Â  Â  Â  Â  Â  Â  transition: var(--transition);Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  Â  Â  color: var(--text);
Â  Â  Â  Â  Â  Â  text-transform: uppercase; /* Asegura mayÃºsculas para el promotor */
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .form-input:focus {Â 
Â  Â  Â  Â  Â  Â  outline: none;Â 
Â  Â  Â  Â  Â  Â  border-color: var(--primary);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .upload-area {
Â  Â  Â  Â  Â  Â  border: 2px dashed var(--primary);Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  padding: 2rem;Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  transition: var(--transition);Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  background: rgba(79, 70, 229, 0.1);Â 
Â  Â  Â  Â  Â  Â  min-height: 200px;
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .upload-area:hover, .upload-area.dragover {Â 
Â  Â  Â  Â  Â  Â  border-color: var(--primary-light);Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(79, 70, 229, 0.2);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .upload-icon {Â 
Â  Â  Â  Â  Â  Â  font-size: 3rem;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;Â 
Â  Â  Â  Â  Â  Â  color: var(--secondary);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .upload-hint {Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;Â 
Â  Â  Â  Â  Â  Â  color: var(--text-light);Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;Â 
Â  Â  Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .upload-count {Â 
Â  Â  Â  Â  Â  Â  background: var(--primary);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  padding: 0.5rem 1.5rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: 20px;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  margin-top: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn {Â 
Â  Â  Â  Â  Â  Â  padding: 0.9rem 1.5rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  transition: var(--transition);Â 
Â  Â  Â  Â  Â  Â  display: inline-flex;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  gap: 0.5rem;Â 
Â  Â  Â  Â  Â  Â  font-size: 1rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-primary {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--accent) 0%, var(--success) 100%);Â 
Â  Â  Â  Â  Â  Â  color: var(--darker);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-secondary {Â 
Â  Â  Â  Â  Â  Â  background: var(--primary);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-warning {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-danger {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--error) 0%, #dc2626 100%);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn:disabled {Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  Â  Â  color: var(--text-light);Â 
Â  Â  Â  Â  Â  Â  cursor: not-allowed;Â 
Â  Â  Â  Â  Â  Â  opacity: 0.6;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .button-group {Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  gap: 1rem;Â 
Â  Â  Â  Â  Â  Â  margin-top: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .progress-container {Â 
Â  Â  Â  Â  Â  Â  margin-top: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .progress-bar {Â 
Â  Â  Â  Â  Â  Â  height: 10px;Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  Â  Â  border-radius: 5px;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .progress-fill {Â 
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);Â 
Â  Â  Â  Â  Â  Â  width: 0%;Â 
Â  Â  Â  Â  Â  Â  transition: width 0.3s ease;Â 
Â  Â  Â  Â  Â  Â  border-radius: 5px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .progress-text {Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;Â 
Â  Â  Â  Â  Â  Â  color: var(--text-light);Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-counter {Â 
Â  Â  Â  Â  Â  Â  display: grid;Â 
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(4, 1fr);Â 
Â  Â  Â  Â  Â  Â  gap: 1rem;Â 
Â  Â  Â  Â  Â  Â  padding: 1rem;Â 
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.3);Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  margin-top: 1rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .counter-item {Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .counter-value {Â 
Â  Â  Â  Â  Â  Â  font-size: 2rem;Â 
Â  Â  Â  Â  Â  Â  font-weight: 700;Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #fff, #e2e8f0);Â 
Â  Â  Â  Â  Â  Â  -webkit-background-clip: text;Â 
Â  Â  Â  Â  Â  Â  -webkit-text-fill-color: transparent;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .counter-label {Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;Â 
Â  Â  Â  Â  Â  Â  color: var(--text-light);Â 
Â  Â  Â  Â  Â  Â  margin-top: 0.25rem;Â 
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .table-container {Â 
Â  Â  Â  Â  Â  Â  overflow-x: auto;Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.3);Â 
Â  Â  Â  Â  Â  Â  margin-top: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  border-collapse: collapse;Â 
Â  Â  Â  Â  Â  Â  min-width: 1000px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table th {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  padding: 1rem;Â 
Â  Â  Â  Â  Â  Â  text-align: left;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;Â 
Â  Â  Â  Â  Â  Â  position: sticky;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  z-index: 10;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table td {Â 
Â  Â  Â  Â  Â  Â  padding: 0.75rem;Â 
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  Â  Â  color: var(--text);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table tr:nth-child(even) {Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.02);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table tr:hover {Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table input {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  padding: 0.75rem;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  Â  Â  border-radius: 6px;Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.07);Â 
Â  Â  Â  Â  Â  Â  color: var(--text);Â 
Â  Â  Â  Â  Â  Â  font-size: 0.95rem;Â 
Â  Â  Â  Â  Â  Â  text-transform: uppercase; /* Para ICC y TelÃ©fono, tambiÃ©n a mayÃºsculas */
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table input:focus {Â 
Â  Â  Â  Â  Â  Â  outline: none;Â 
Â  Â  Â  Â  Â  Â  border-color: var(--primary);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .registros-table input.error-input {Â 
Â  Â  Â  Â  Â  Â  border-color: var(--error);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .estado-badge {Â 
Â  Â  Â  Â  Â  Â  display: inline-flex;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  Â  Â  padding: 0.5rem 1rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: 20px;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .status-valid {Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(16, 185, 129, 0.15);Â 
Â  Â  Â  Â  Â  Â  color: var(--success);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .status-incomplete {Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(245, 158, 11, 0.15);Â 
Â  Â  Â  Â  Â  Â  color: var(--warning);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .status-empty {Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(239, 68, 68, 0.15);Â 
Â  Â  Â  Â  Â  Â  color: var(--error);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .results-summary {Â 
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  Â  Â  margin-top: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  padding: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .summary-grid {Â 
Â  Â  Â  Â  Â  Â  display: grid;Â 
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(4, 1fr);Â 
Â  Â  Â  Â  Â  Â  gap: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .summary-card {Â 
Â  Â  Â  Â  Â  Â  background: var(--darker);Â 
Â  Â  Â  Â  Â  Â  padding: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .summary-value {Â 
Â  Â  Â  Â  Â  Â  font-size: 2.5rem;Â 
Â  Â  Â  Â  Â  Â  font-weight: 800;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .summary-success { color: var(--success); }
Â  Â  Â  Â  .summary-warning { color: var(--warning); }
Â  Â  Â  Â  .summary-error { color: var(--error); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .log {Â 
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  padding: 1rem;Â 
Â  Â  Â  Â  Â  Â  height: 300px;Â 
Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  Â  Â  font-family: 'Courier New', monospace;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;Â 
Â  Â  Â  Â  Â  Â  line-height: 1.5;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .log-entry {Â 
Â  Â  Â  Â  Â  Â  padding: 0.5rem 1rem;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;Â 
Â  Â  Â  Â  Â  Â  border-left: 4px solid;Â 
Â  Â  Â  Â  Â  Â  border-radius: 4px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .log-entry.success {Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(16, 185, 129, 0.1);Â 
Â  Â  Â  Â  Â  Â  color: var(--success);Â 
Â  Â  Â  Â  Â  Â  border-left-color: var(--success);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .log-entry.error {Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(239, 68, 68, 0.1);Â 
Â  Â  Â  Â  Â  Â  color: var(--error);Â 
Â  Â  Â  Â  Â  Â  border-left-color: var(--error);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .log-entry.warning {Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(245, 158, 11, 0.1);Â 
Â  Â  Â  Â  Â  Â  color: var(--warning);Â 
Â  Â  Â  Â  Â  Â  border-left-color: var(--warning);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .log-entry.info {Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(79, 70, 229, 0.1);Â 
Â  Â  Â  Â  Â  Â  color: var(--primary-light);Â 
Â  Â  Â  Â  Â  Â  border-left-color: var(--primary-light);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .log-header {Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  justify-content: space-between;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .footer {Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  padding: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  color: var(--text-light);Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;Â 
Â  Â  Â  Â  Â  Â  background: var(--darker);Â 
Â  Â  Â  Â  Â  Â  border-top: 1px solid rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .toast {Â 
Â  Â  Â  Â  Â  Â  position: fixed;Â 
Â  Â  Â  Â  Â  Â  top: 20px;Â 
Â  Â  Â  Â  Â  Â  right: 20px;Â 
Â  Â  Â  Â  Â  Â  padding: 1rem 1.5rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: var(--radius);Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(30, 41, 59, 0.95);Â 
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-lg);Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  gap: 0.75rem;Â 
Â  Â  Â  Â  Â  Â  z-index: 1000;Â 
Â  Â  Â  Â  Â  Â  transform: translateX(150%);Â 
Â  Â  Â  Â  Â  Â  transition: transform 0.3s ease;Â 
Â  Â  Â  Â  Â  Â  max-width: 400px;Â 
Â  Â  Â  Â  Â  Â  color: var(--text);Â 
Â  Â  Â  Â  Â  Â  border-left: 4px solid;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .toast.show {Â 
Â  Â  Â  Â  Â  Â  transform: translateX(0);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .toast-success { border-left-color: var(--success); }
Â  Â  Â  Â  .toast-error { border-left-color: var(--error); }
Â  Â  Â  Â  .toast-warning { border-left-color: var(--warning); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .hidden {
Â  Â  Â  Â  Â  Â  display: none !important;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .app-container {Â 
Â  Â  Â  Â  Â  Â  Â  Â  margin: 0;Â 
Â  Â  Â  Â  Â  Â  Â  Â  border-radius: 0;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .registros-counter,
Â  Â  Â  Â  Â  Â  .summary-grid {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(2, 1fr);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .button-group .btn {Â 
Â  Â  Â  Â  Â  Â  Â  Â  min-width: 100%;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .registros-table {Â 
Â  Â  Â  Â  Â  Â  Â  Â  min-width: 800px;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .company-name {
Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.4rem;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .app-title {
Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @media (max-width: 480px) {
Â  Â  Â  Â  Â  Â  .registros-counter,
Â  Â  Â  Â  Â  Â  .summary-grid {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="app-container">
Â  Â  Â  Â  <header class="header">
Â  Â  Â  Â  Â  Â  <div class="logo-icon">ðŸ“±</div>
Â  Â  Â  Â  Â  Â  <div class="company-name">SERVICIOS INTEGRALES MADA</div>
Â  Â  Â  Â  Â  Â  <div class="app-title">SISTEMA DE REGISTRO DE PORTABILIDADES</div>
Â  Â  Â  Â  Â  Â  <div class="app-subtitle">OCR especializado en telÃ©fono e ICC</div>
Â  Â  Â  Â  Â  Â  <div class="system-status" id="systemStatus">Estado del sistema: Listo</div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main class="main-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card" id="promotor-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title"><i class="fas fa-user"></i> Paso 1: Ingresa tu nombre</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label" for="promotor">Nombre completo del promotor *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="promotor" class="form-input" placeholder="Ej: Juan PÃ©rez HernÃ¡ndez" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="input-hint">Este nombre se asignarÃ¡ a todos los trÃ¡mites que proceses.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card" id="upload-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title"><i class="fas fa-file-upload"></i> Paso 2: Sube las capturas</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="upload-area" id="uploadArea">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="upload-text">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="uploadText">Arrastra y suelta las capturas o haz clic para seleccionar</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="upload-hint" style="margin-top: 0.5rem;">Puedes subir 1 imagen para un trÃ¡mite individual, o hasta 40 imÃ¡genes para procesamiento masivo</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="upload-hint"><strong>OCR ESPECIALIZADO:</strong> Solo extraerÃ¡ telÃ©fono (10 dÃ­gitos) e ICC (18-20 dÃ­gitos)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="upload-count" id="uploadCount">0 capturas seleccionadas</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="fileInput" accept="image/*" multiple style="display: none;" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="btnProcesarOCR" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-search-plus"></i> Procesar capturas con OCR
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-warning" id="btnLimpiarImagenes" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trash-alt"></i> Limpiar imÃ¡genes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-container" id="progressContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-text" id="progressText">Preparando procesamiento...</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card hidden" id="table-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title"><i class="fas fa-table"></i> Resultados del Procesamiento</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="registros-counter">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="counter-item"><div class="counter-value" id="counterTotal">0</div><div class="counter-label">Total Registros</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="counter-item"><div class="counter-value" id="counterValidados">0</div><div class="counter-label">Completos VÃ¡lidos</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="counter-item"><div class="counter-value" id="counterPendientes">0</div><div class="counter-label">Faltan Datos</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="counter-item"><div class="counter-value" id="counterVacios">0</div><div class="counter-label">Por Validar</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="registros-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 5%;">#</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 25%;">PROMOTOR</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 15%;">TELÃ‰FONO (10 dÃ­gitos)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 25%;">ICC (18-20 dÃ­gitos)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 15%;">Estado</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 15%;">Acciones</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="cuerpoTabla">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-group" style="margin-top: 1.5rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-warning" id="btnLimpiarTabla"><i class="fas fa-broom"></i> Limpiar tabla</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-danger" id="btnEliminarInvalidos"><i class="fas fa-filter"></i> Eliminar no vÃ¡lidos</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="btnValidarTodos"><i class="fas fa-check-double"></i> Validar todos</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card hidden" id="send-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="card-title"><i class="fas fa-paper-plane"></i> Paso 3: Enviar Registros</h2>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="results-summary hidden" id="resultsSummary">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="margin-bottom: 1rem; color: var(--text);">Resumen del EnvÃ­o</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-card"><div class="summary-value summary-success" id="summaryExitosos">0</div><div class="counter-label">Ã‰xitos</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-card"><div class="summary-value summary-warning" id="summaryDuplicados">0</div><div class="counter-label">Duplicados</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-card"><div class="summary-value summary-error" id="summaryErrores">0</div><div class="counter-label">Errores</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-card"><div class="summary-value" id="summaryTotal">0</div><div class="counter-label">Total Procesados</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="detallesEnvio" style="font-size: 0.9rem; color: var(--text-light); margin-top: 1rem;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" id="btnEnviarLote" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-share-square"></i> ENVIAR REGISTROS
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="btnPrevisualizar" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-eye"></i> Previsualizar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card" id="log-card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="log-title"><i class="fas fa-file-alt"></i> Registro de Actividad</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="btnClearLog"><i class="fas fa-trash-alt"></i> Limpiar</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="log-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="log" id="log"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>

Â  Â  Â  Â  <footer class="footer">
Â  Â  Â  Â  Â  Â  <p>SERVICIOS INTEGRALES MADA &copy; 2023 | Sistema de Registro de Portabilidades</p>
Â  Â  Â  Â  </footer>
Â  Â  </div>

Â  Â  <div class="toast" id="toast">
Â  Â  Â  Â  <div class="toast-icon" id="toastIcon"></div>
Â  Â  Â  Â  <div class="toast-message" id="toastMessage"></div>
Â  Â  </div>
Â  Â Â 
Â  Â  <script>
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 1. CONFIGURACIÃ“N
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const CONFIG = {
Â  Â  Â  Â  Â  Â  MAX_REGISTROS: 40,
Â  Â  Â  Â  Â  Â  // ðŸ›‘ REEMPLAZA ESTA URL CON LA URL DE TU APPS SCRIPT
Â  Â  Â  Â  Â  Â  WEBAPP_URL: 'REEMPLAZA_CON_TU_URL_APPS_SCRIPT/exec'
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 2. ESTADO GLOBAL
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const Estado = {
Â  Â  Â  Â  Â  Â  imagenes: [],
Â  Â  Â  Â  Â  Â  registros: [],
Â  Â  Â  Â  Â  Â  promotorActual: '',
Â  Â  Â  Â  Â  Â  ocrEnProgreso: false,
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  inicializarRegistro: () => {
Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: Date.now() + Math.random(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  promotor: Utils.Data.normalizarTexto(Estado.promotorActual), // NormalizaciÃ³n aquÃ­
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  telefono: '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icc: '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  validado: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completo: false
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  obtenerRegistrosValidos: () => {
Â  Â  Â  Â  Â  Â  Â  Â  return Estado.registros.filter(r => r.validado);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 3. CACHE DE ELEMENTOS DOM (sin cambios)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const D = {};
Â  Â  Â  Â Â 
Â  Â  Â  Â  const cachearElementosDOM = () => {
Â  Â  Â  Â  Â  Â  const elementos = [
Â  Â  Â  Â  Â  Â  Â  Â  'promotor', 'uploadArea', 'uploadText', 'uploadCount', 'fileInput',
Â  Â  Â  Â  Â  Â  Â  Â  'btnProcesarOCR', 'btnLimpiarImagenes', 'progressContainer', 'progressFill', 'progressText',
Â  Â  Â  Â  Â  Â  Â  Â  'btnEnviarLote', 'btnPrevisualizar', 'cuerpoTabla', 'counterTotal', 'counterValidados',
Â  Â  Â  Â  Â  Â  Â  Â  'counterPendientes', 'counterVacios', 'btnLimpiarTabla', 'btnEliminarInvalidos',
Â  Â  Â  Â  Â  Â  Â  Â  'btnValidarTodos', 'log', 'btnClearLog', 'systemStatus', 'resultsSummary',
Â  Â  Â  Â  Â  Â  Â  Â  'summaryExitosos', 'summaryDuplicados', 'summaryErrores', 'summaryTotal', 'detallesEnvio',
Â  Â  Â  Â  Â  Â  Â  Â  'toast', 'toastIcon', 'toastMessage', 'table-card', 'send-card'
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  elementos.forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  D[id] = document.getElementById(id);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 4. UTILIDADES (MODIFICADO: Se agrega normalizaciÃ³n de texto)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const Utils = {
Â  Â  Â  Â  Â  Â  UI: {
Â  Â  Â  Â  Â  Â  Â  Â  // ... Toast y Log functions (sin cambios)
Â  Â  Â  Â  Â  Â  Â  Â  mostrarToast: (mensaje, tipo = "success", duracion = 3000) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.toast.className = `toast toast-${tipo}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.toastMessage.textContent = mensaje;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iconos = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  success: '<i class="fas fa-check-circle"></i>',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  error: '<i class="fas fa-times-circle"></i>',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  warning: '<i class="fas fa-exclamation-triangle"></i>',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  info: '<i class="fas fa-info-circle"></i>'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.toastIcon.innerHTML = iconos[tipo] || iconos.info;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.toast.classList.add("show");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.toast.classList.remove("show");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, duracion);
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  agregarLog: (mensaje, tipo = "info") => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timestamp = new Date().toLocaleTimeString('es-MX', {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hour: '2-digit',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minute: '2-digit',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  second: '2-digit'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const logEntry = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logEntry.className = `log-entry ${tipo}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logEntry.textContent = `[${timestamp}] ${mensaje}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.log.appendChild(logEntry);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.log.scrollTop = D.log.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  limpiarLog: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.log.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog("Registro de actividad limpiado.", "info");
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  mostrarElemento: (id) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const elemento = document.getElementById(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (elemento) elemento.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  ocultarElemento: (id) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const elemento = document.getElementById(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (elemento) elemento.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  actualizarProgreso: (porcentaje, mensaje) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (D.progressFill) D.progressFill.style.width = `${porcentaje}%`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (D.progressText) D.progressText.textContent = mensaje;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Data: {
Â  Â  Â  Â  Â  Â  Â  Â  // NUEVA UTILIDAD DE NORMALIZACIÃ“N
Â  Â  Â  Â  Â  Â  Â  Â  normalizarTexto: (texto) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!texto) return '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return String(texto)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .normalize("NFD")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/[\u0300-\u036f]/g, "") // Eliminar acentos
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .toUpperCase() // Forzar mayÃºsculas
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .trim();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  validarTelefono: (telefono) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const limpio = telefono.replace(/\D/g, '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return limpio.length === 10;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  validarICC: (icc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const limpio = icc.replace(/\D/g, '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return limpio.length >= 18 && limpio.length <= 20;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  extraerDatosOCR: (texto) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const resultado = { telefono: '', icc: '' };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textoLimpio = texto.replace(/\s+/g, '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Buscar telÃ©fono (10 dÃ­gitos)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const matchTelefono = textoLimpio.match(/\d{10}/g);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (matchTelefono) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultado.telefono = matchTelefono[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Buscar ICC (18-20 dÃ­gitos)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iccs = textoLimpio.match(/\d{18,20}/g) || [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (iccs.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ordenar por longitud (mÃ¡s largo primero)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iccs.sort((a, b) => b.length - a.length);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultado.icc = iccs[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return resultado;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 5. MÃ“DULO DE OCR CORREGIDO (sin cambios)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const OCR = {
Â  Â  Â  Â  Â  Â  // ... (funciones procesarImagen y procesarLoteImagenes sin cambios en la lÃ³gica principal)
Â  Â  Â  Â  Â  Â  procesarImagen: async (file) => {
Â  Â  Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = async (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await Tesseract.recognize(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.result,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'eng',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logger: m => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Opcional: mostrar progreso
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve(Utils.Data.extraerDatosOCR(result.data.text));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reject(new Error(`Error en OCR: ${error.message}`));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.onerror = () => reject(new Error("Error al leer archivo"));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  procesarLoteImagenes: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (Estado.imagenes.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("No hay imÃ¡genes para procesar", "warning");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (Estado.ocrEnProgreso) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("Ya hay un proceso OCR en ejecuciÃ³n", "warning");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Validar que haya promotor y normalizarlo
Â  Â  Â  Â  Â  Â  Â  Â  const promotorNormalizado = Utils.Data.normalizarTexto(Estado.promotorActual);
Â  Â  Â  Â  Â  Â  Â  Â  if (!promotorNormalizado || promotorNormalizado.length < 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("Primero ingresa tu nombre completo (mÃ­n. 3 caracteres)", "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.promotor.focus();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Estado.promotorActual = promotorNormalizado; // Aplicar la versiÃ³n normalizada
Â  Â  Â  Â  Â  Â  Â  Â  D.promotor.value = promotorNormalizado;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Estado.ocrEnProgreso = true;
Â  Â  Â  Â  Â  Â  Â  Â  D.btnProcesarOCR.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  D.btnLimpiarImagenes.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  D.progressContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  D.progressFill.style.width = '0%';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const totalImagenes = Estado.imagenes.length;
Â  Â  Â  Â  Â  Â  Â  Â  let procesados = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let exitosos = 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`Iniciando OCR de ${totalImagenes} captura(s)...`, "info");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarElemento('table-card');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarElemento('send-card');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Limpiar tabla existente y registros
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.cuerpoTabla.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 0; i < totalImagenes; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const file = Estado.imagenes[i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.actualizarProgreso(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (i / totalImagenes) * 100,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Procesando imagen ${i + 1} de ${totalImagenes}...`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const resultado = await OCR.procesarImagen(file);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  procesados++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Crear nuevo registro con los datos del OCR
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nuevoRegistro = Estado.inicializarRegistro();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (resultado.telefono || resultado.icc) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nuevoRegistro.telefono = resultado.telefono;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nuevoRegistro.icc = resultado.icc;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  exitosos++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `Imagen ${i + 1}: ${resultado.telefono ? 'TelÃ©fono extraÃ­do' : ''} ${resultado.icc ? 'ICC extraÃ­do' : ''}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "success"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`Imagen ${i + 1}: No se encontraron datos`, "warning");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros.push(nuevoRegistro);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Agregar fila a la tabla
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.agregarFila(nuevoRegistro, i);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // PequeÃ±a pausa entre procesamientos
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(resolve => setTimeout(resolve, 500));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Crear registro vacÃ­o para esta imagen
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nuevoRegistro = Estado.inicializarRegistro();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros.push(nuevoRegistro);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.agregarFila(nuevoRegistro, i);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`Error en imagen ${i + 1}: ${error.message}`, "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Finalizar proceso
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.actualizarProgreso(100, "Procesamiento completado");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarContadores();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Limpiar imÃ¡genes procesadas
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.imagenes = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.uploadCount.textContent = "0 capturas seleccionadas";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.uploadText.textContent = "Arrastra y suelta las capturas o haz clic para seleccionar";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.btnProcesarOCR.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`OCR completado: ${exitosos} de ${totalImagenes} imÃ¡genes procesadas`, "info");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast(`Procesadas ${totalImagenes} imÃ¡genes`, exitosos > 0 ? "success" : "warning", 3000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`Error crÃ­tico en OCR: ${error.message}`, "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("Error en el proceso OCR", "error");
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.ocrEnProgreso = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.progressContainer.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.progressFill.style.width = '0%';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 6. MÃ“DULO DE TABLA (MODIFICADO: Se aplica normalizaciÃ³n)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const Tabla = {
Â  Â  Â  Â  Â  Â  agregarFila: (registro, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  Â  Â  tr.id = `fila-${index}`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align: center; font-weight: 600;">${index + 1}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-field="promotor"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-index="${index}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="Nombre del promotor"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="promotor-input"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value="${registro.promotor || ''}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â readonly>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-field="telefono"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-index="${index}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="10 dÃ­gitos"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â maxlength="10"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="telefono-input"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value="${registro.telefono || ''}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-field="icc"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-index="${index}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="18-20 dÃ­gitos"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â maxlength="20"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="icc-input"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value="${registro.icc || ''}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="estado-badge" id="estado-${index}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-clock"></i> POR VALIDAR
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td style="text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="btn btn-danger"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="Tabla.limpiarFila(${index})"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="padding: 0.5rem 1rem; font-size: 0.9rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-times"></i> Limpiar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  D.cuerpoTabla.appendChild(tr);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // AÃ±adir listeners de input
Â  Â  Â  Â  Â  Â  Â  Â  const inputs = tr.querySelectorAll('input');
Â  Â  Â  Â  Â  Â  Â  Â  inputs.forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!input.hasAttribute('readonly')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.addEventListener('input', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(e.target.getAttribute('data-index'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const field = e.target.getAttribute('data-field');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let value = e.target.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Solo nÃºmeros para telÃ©fono e ICC (y limitar)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (field !== 'promotor') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value = value.replace(/\D/g, '').slice(0, field === 'telefono' ? 10 : 20);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.value = value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // NORMALIZACIÃ“N: Aplica normalizaciÃ³n de texto a la entrada manual del promotor en la tabla
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value = Utils.Data.normalizarTexto(value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.value = value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarRegistro(index, field, value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Tabla.validarFila(index);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  actualizarRegistro: (index, campo, valor) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (Estado.registros[index]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros[index][campo] = valor;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.validarFila(index);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarContadores();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  validarFila: (index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const registro = Estado.registros[index];
Â  Â  Â  Â  Â  Â  Â  Â  if (!registro) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const telefonoInput = document.querySelector(`#fila-${index} input[data-field="telefono"]`);
Â  Â  Â  Â  Â  Â  Â  Â  const iccInput = document.querySelector(`#fila-${index} input[data-field="icc"]`);
Â  Â  Â  Â  Â  Â  Â  Â  const estadoBadge = document.getElementById(`estado-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // La validaciÃ³n usa la utilidad de normalizaciÃ³n para el promotor
Â  Â  Â  Â  Â  Â  Â  Â  const promotorNormalizado = Utils.Data.normalizarTexto(registro.promotor);
Â  Â  Â  Â  Â  Â  Â  Â  const telefonoValido = Utils.Data.validarTelefono(registro.telefono);
Â  Â  Â  Â  Â  Â  Â  Â  const iccValido = Utils.Data.validarICC(registro.icc);
Â  Â  Â  Â  Â  Â  Â  Â  const promotorValido = promotorNormalizado.length >= 3;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  registro.validado = telefonoValido && iccValido && promotorValido;
Â  Â  Â  Â  Â  Â  Â  Â  registro.completo = registro.telefono.length > 0 || registro.icc.length > 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Feedback visual
Â  Â  Â  Â  Â  Â  Â  Â  if (telefonoInput) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  telefonoInput.classList.toggle('error-input', registro.telefono.length > 0 && !telefonoValido);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (iccInput) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iccInput.classList.toggle('error-input', registro.icc.length > 0 && !iccValido);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Actualizar badge
Â  Â  Â  Â  Â  Â  Â  Â  if (registro.validado) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estadoBadge.innerHTML = `<i class="fas fa-check-circle"></i> VÃLIDO`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estadoBadge.className = "estado-badge status-valid";
Â  Â  Â  Â  Â  Â  Â  Â  } else if (registro.completo) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estadoBadge.innerHTML = `<i class="fas fa-exclamation-triangle"></i> INCOMPLETO`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estadoBadge.className = "estado-badge status-incomplete";
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estadoBadge.innerHTML = `<i class="fas fa-clock"></i> POR VALIDAR`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estadoBadge.className = "estado-badge status-empty";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ... resto de funciones de Tabla (sin cambios lÃ³gicos)
Â  Â  Â  Â  Â  Â  actualizarContadores: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const total = Estado.registros.length;
Â  Â  Â  Â  Â  Â  Â  Â  const validados = Estado.registros.filter(r => r.validado).length;
Â  Â  Â  Â  Â  Â  Â  Â  const pendientes = Estado.registros.filter(r => r.completo && !r.validado).length;
Â  Â  Â  Â  Â  Â  Â  Â  const vacios = Estado.registros.filter(r => !r.completo).length;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  D.counterTotal.textContent = total;
Â  Â  Â  Â  Â  Â  Â  Â  D.counterValidados.textContent = validados;
Â  Â  Â  Â  Â  Â  Â  Â  D.counterPendientes.textContent = pendientes;
Â  Â  Â  Â  Â  Â  Â  Â  D.counterVacios.textContent = vacios;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Actualizar botones
Â  Â  Â  Â  Â  Â  Â  Â  D.btnEnviarLote.disabled = validados === 0;
Â  Â  Â  Â  Â  Â  Â  Â  D.btnPrevisualizar.disabled = validados === 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (validados > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.btnEnviarLote.innerHTML = `<i class="fas fa-share-square"></i> ENVIAR (${validados} vÃ¡lidos)`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  limpiarFila: (index) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (Estado.registros[index]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros[index].telefono = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros[index].icc = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros[index].validado = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros[index].completo = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll(`#fila-${index} input`).forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!input.hasAttribute('readonly')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.classList.remove('error-input');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.validarFila(index);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarContadores();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`Fila ${index + 1} limpiada`, "info");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  limpiarTablaCompleta: () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (Estado.registros.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("La tabla ya estÃ¡ vacÃ­a", "info");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!confirm("Â¿EstÃ¡s seguro de limpiar todos los registros?")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros = [];
Â  Â  Â  Â  Â  Â  Â  Â  D.cuerpoTabla.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarContadores();
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.ocultarElemento('table-card');
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.ocultarElemento('send-card');
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("Tabla limpiada", "success");
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog("Tabla completa limpiada", "info");
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  eliminarInvalidos: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const invalidos = Estado.registros.filter(r => r.completo && !r.validado);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (invalidos.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("No hay registros invÃ¡lidos", "info");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!confirm(`Â¿Eliminar ${invalidos.length} registros invÃ¡lidos?`)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Filtrar solo los vÃ¡lidos
Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros = Estado.registros.filter(r => r.validado);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Reconstruir tabla
Â  Â  Â  Â  Â  Â  Â  Â  D.cuerpoTabla.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros.forEach((registro, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.agregarFila(registro, index);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarContadores();
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast(`${invalidos.length} registros eliminados`, "success");
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`${invalidos.length} registros invÃ¡lidos eliminados`, "info");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 7. MÃ“DULO DE ENVÃO (sin cambios lÃ³gicos)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const Envio = {
Â  Â  Â  Â  Â  Â  enviarRegistros: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const registrosValidos = Estado.obtenerRegistrosValidos();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (registrosValidos.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("No hay registros vÃ¡lidos para enviar", "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!confirm(`Â¿Enviar ${registrosValidos.length} registros vÃ¡lidos?`)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Preparar UI
Â  Â  Â  Â  Â  Â  Â  Â  D.btnEnviarLote.disabled = D.btnPrevisualizar.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  D.progressContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.actualizarProgreso(10, "Preparando envÃ­o...");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`Enviando ${registrosValidos.length} registros...`, "info");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const datosEnvio = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: "guardarMultiplesRegistros",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nombreLote: `Registro_${new Date().toISOString().slice(0,10)}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Se envÃ­a la versiÃ³n ya normalizada del registro
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  registros: registrosValidos.map(r => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  promotor: r.promotor,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  telefono: r.telefono,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icc: r.icc
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }))
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.actualizarProgreso(30, "Conectando con el servidor...");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Enviar datos al backend
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(CONFIG.WEBAPP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(datosEnvio)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.actualizarProgreso(70, "Enviando datos...");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Manejar respuesta
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.actualizarProgreso(100, "EnvÃ­o completado!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Mostrar resultados
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Envio.mostrarResultados(result);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`EnvÃ­o completado: ${result.exitosos || registrosValidos.length} registros guardados`, "success");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast(`EnvÃ­o exitoso: ${result.exitosos || registrosValidos.length} registros`, "success", 5000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Preguntar si limpiar despuÃ©s de enviar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (confirm("Â¿Deseas limpiar la tabla para nuevos registros?")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.limpiarTablaCompleta();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`Error en envÃ­o: ${error.message}`, "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast(`Error: ${error.message}`, "error", 5000);
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.btnEnviarLote.disabled = D.btnPrevisualizar.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.progressContainer.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.actualizarProgreso(0, "Listo");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 1500);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ... resto de funciones de EnvÃ­o (sin cambios lÃ³gicos)
Â  Â  Â  Â  Â  Â  mostrarResultados: (resultado) => {
Â  Â  Â  Â  Â  Â  Â  Â  D.resultsSummary.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  D.summaryExitosos.textContent = resultado.exitosos || 0;
Â  Â  Â  Â  Â  Â  Â  Â  D.summaryDuplicados.textContent = resultado.duplicados || 0;
Â  Â  Â  Â  Â  Â  Â  Â  D.summaryErrores.textContent = resultado.errores || 0;
Â  Â  Â  Â  Â  Â  Â  Â  D.summaryTotal.textContent = resultado.total || Estado.obtenerRegistrosValidos().length;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let detallesHTML = `<div style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">`;
Â  Â  Â  Â  Â  Â  Â  Â  detallesHTML += `<p><strong>ðŸ“… Lote:</strong> ${resultado.lote || 'Registro'}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  detallesHTML += `<p><strong>ðŸ“Š Resultado:</strong> ${resultado.message || 'EnvÃ­o completado'}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (resultado.sheetUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  detallesHTML += `<p><strong>ðŸ”— URL:</strong> <a href="${resultado.sheetUrl}" target="_blank" style="color: var(--primary-light);">Ver en Google Sheets</a></p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  detallesHTML += `</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  D.detallesEnvio.innerHTML = detallesHTML;
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  previsualizar: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const registrosValidos = Estado.obtenerRegistrosValidos();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (registrosValidos.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("No hay registros vÃ¡lidos para previsualizar", "warning");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let previsualizacion = `ðŸ“‹ PREVISUALIZACIÃ“N\n`;
Â  Â  Â  Â  Â  Â  Â  Â  previsualizacion += `========================\n`;
Â  Â  Â  Â  Â  Â  Â  Â  previsualizacion += `Total: ${registrosValidos.length} registros\n`;
Â  Â  Â  Â  Â  Â  Â  Â  previsualizacion += `Promotor: ${Estado.promotorActual}\n`;
Â  Â  Â  Â  Â  Â  Â  Â  previsualizacion += `========================\n\n`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  registrosValidos.forEach((r, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previsualizacion += `${index + 1}. ${r.promotor} | Tel: ${r.telefono} | ICC: ${r.icc}\n`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  alert(previsualizacion);
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog("PrevisualizaciÃ³n generada", "info");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 8. MANEJO DE EVENTOS (MODIFICADO: Promotor usa normalizaciÃ³n)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  const Events = {
Â  Â  Â  Â  Â  Â  manejarArchivos: (files) => {
Â  Â  Â  Â  Â  Â  Â  Â  // ... (validaciÃ³n de promotor ahora usa normalizaciÃ³n)
Â  Â  Â  Â  Â  Â  Â  Â  const promotorNormalizado = Utils.Data.normalizarTexto(D.promotor.value);
Â  Â  Â  Â  Â  Â  Â  Â  if (!promotorNormalizado || promotorNormalizado.length < 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("Primero ingresa tu nombre completo (mÃ­n. 3 caracteres)", "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.promotor.focus();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ... (resto sin cambios lÃ³gicos)
Â  Â  Â  Â  Â  Â  Â  Â  const archivosArray = Array.from(files);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Limitar a 40 archivos mÃ¡ximo
Â  Â  Â  Â  Â  Â  Â  Â  const archivosLimitados = archivosArray.slice(0, CONFIG.MAX_REGISTROS);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Validar que sean imÃ¡genes
Â  Â  Â  Â  Â  Â  Â  Â  const archivosValidos = archivosLimitados.filter(file => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!file.type.startsWith('image/')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast(`${file.name} no es una imagen vÃ¡lida`, "warning");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (archivosValidos.length === 0) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (archivosValidos.length > CONFIG.MAX_REGISTROS) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast(`Solo se pueden procesar hasta ${CONFIG.MAX_REGISTROS} imÃ¡genes`, "warning");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Actualizar estado
Â  Â  Â  Â  Â  Â  Â  Â  Estado.imagenes = archivosValidos;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Actualizar UI
Â  Â  Â  Â  Â  Â  Â  Â  D.uploadText.textContent = `${Estado.imagenes.length} captura(s) lista(s) para procesar`;
Â  Â  Â  Â  Â  Â  Â  Â  D.uploadCount.textContent = `${Estado.imagenes.length} captura(s) seleccionada(s)`;
Â  Â  Â  Â  Â  Â  Â  Â  D.btnProcesarOCR.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  D.btnLimpiarImagenes.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast(`${archivosValidos.length} imagen(es) cargada(s)`, "success");
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog(`${archivosValidos.length} imagen(es) cargada(s) para OCR`, "success");
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  configurarListeners: () => {
Â  Â  Â  Â  Â  Â  Â  Â  // Cachear elementos
Â  Â  Â  Â  Â  Â  Â  Â  cachearElementosDOM();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Promotor - actualizar estado global con normalizaciÃ³n
Â  Â  Â  Â  Â  Â  Â  Â  D.promotor.addEventListener('input', function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const normalizado = Utils.Data.normalizarTexto(this.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.value = normalizado; // Forzar mayÃºsculas/sin acentos
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.promotorActual = normalizado;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Actualizar promotor en todos los registros existentes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros.forEach(registro => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  registro.promotor = Estado.promotorActual;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Actualizar inputs readonly en la tabla
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('input[data-field="promotor"]').forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.value = Estado.promotorActual;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Revalidar todos los registros
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros.forEach((_, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.validarFila(index);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarContadores();
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Upload Area
Â  Â  Â  Â  Â  Â  Â  Â  function preventDefaults(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.uploadArea.addEventListener(eventName, preventDefaults, false);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  D.uploadArea.addEventListener('click', () => D.fileInput.click());
Â  Â  Â  Â  Â  Â  Â  Â  D.uploadArea.addEventListener('drop', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.uploadArea.classList.remove('dragover');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Events.manejarArchivos(e.dataTransfer.files);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  D.uploadArea.addEventListener('dragover', () => D.uploadArea.classList.add('dragover'));
Â  Â  Â  Â  Â  Â  Â  Â  D.uploadArea.addEventListener('dragleave', () => D.uploadArea.classList.remove('dragover'));
Â  Â  Â  Â  Â  Â  Â  Â  D.fileInput.addEventListener('change', (e) => Events.manejarArchivos(e.target.files));
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Botones
Â  Â  Â  Â  Â  Â  Â  Â  D.btnProcesarOCR.addEventListener('click', () => OCR.procesarLoteImagenes());
Â  Â  Â  Â  Â  Â  Â  Â  D.btnLimpiarImagenes.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.imagenes = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.uploadCount.textContent = "0 capturas seleccionadas";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.uploadText.textContent = "Arrastra y suelta las capturas o haz clic para seleccionar";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.btnProcesarOCR.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.btnLimpiarImagenes.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("ImÃ¡genes limpiadas", "success");
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  D.btnClearLog.addEventListener('click', Utils.UI.limpiarLog);
Â  Â  Â  Â  Â  Â  Â  Â  D.btnLimpiarTabla.addEventListener('click', Tabla.limpiarTablaCompleta);
Â  Â  Â  Â  Â  Â  Â  Â  D.btnEliminarInvalidos.addEventListener('click', Tabla.eliminarInvalidos);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  D.btnValidarTodos.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Estado.registros.forEach((_, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.validarFila(index);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Tabla.actualizarContadores();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.mostrarToast("ValidaciÃ³n completada", "success");
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  D.btnEnviarLote.addEventListener('click', Envio.enviarRegistros);
Â  Â  Â  Â  Â  Â  Â  Â  D.btnPrevisualizar.addEventListener('click', Envio.previsualizar);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 9. INICIALIZACIÃ“N (sin cambios)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  function inicializarSistema() {
Â  Â  Â  Â  Â  Â  Events.configurarListeners();
Â  Â  Â  Â  Â  Â  D.systemStatus.textContent = "Estado: Listo para procesar";
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog("Sistema MADA inicializado", "info");
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog("1. Ingresa tu nombre completo", "info");
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog("2. Sube las capturas (hasta 40)", "info");
Â  Â  Â  Â  Â  Â  Â  Â  Utils.UI.agregarLog("3. Haz clic en 'Procesar capturas con OCR'", "info");
Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  }

Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // 10. EJECUCIÃ“N (sin cambios)
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', inicializarSistema);
Â  Â  </script>
</body>
</html>
